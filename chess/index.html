<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â™” Ø´Ø·Ø±Ù†Ø¬ Ù¾ÛŒØ´Ø±ÙØªÙ‡ - ØªØªØ±Ø§Ø´Ø§Ù¾</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@vazirmatn/monospace@latest/font-face.css">
    <style>
        * {
            font-family: 'Vazirmatn', sans-serif;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid #4361ee;
        }
        
        .chess-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }
        
        .chess-board {
            flex: 1;
            min-width: 500px;
            background: #2d3047;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            width: 480px;
            height: 480px;
            margin: 0 auto;
            border: 3px solid #333;
        }
        
        .square {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .square:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .light {
            background: #f0d9b5;
        }
        
        .dark {
            background: #b58863;
        }
        
        .selected {
            background: #4cc9f0 !important;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        
        .controls {
            flex: 1;
            min-width: 300px;
            background: rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .btn {
            background: linear-gradient(45deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #f72585, #b5179e);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #4cc9f0, #4895ef);
        }
        
        .move-history {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .move-item {
            padding: 8px 15px;
            margin: 5px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            border-right: 3px solid #4361ee;
        }
        
        .status {
            background: rgba(76, 201, 240, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid #4cc9f0;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        .player {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            flex: 1;
            margin: 0 10px;
        }
        
        .player-white {
            background: rgba(255,255,255,0.1);
            border: 2px solid #fff;
        }
        
        .player-black {
            background: rgba(0,0,0,0.3);
            border: 2px solid #000;
        }
        
        @media (max-width: 768px) {
            .chess-container {
                flex-direction: column;
            }
            
            .chess-board, .controls {
                min-width: 100%;
            }
            
            .board {
                width: 320px;
                height: 320px;
            }
            
            .square {
                width: 40px;
                height: 40px;
                font-size: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>â™” Ø´Ø·Ø±Ù†Ø¬ Ù¾ÛŒØ´Ø±ÙØªÙ‡ - ØªØªØ±Ø§Ø´Ø§Ù¾</h1>
            <p>Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø³Ø·Ø­ GM | Ù‚ÛŒÙ…Øª: Û¹Û¹,Û°Û°Û° Ø±ÛŒØ§Ù„ Ù…Ø§Ù‡Ø§Ù†Ù‡</p>
            <div class="status" id="gameStatus">
                <strong>ÙˆØ¶Ø¹ÛŒØª:</strong> Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯ | Ù†ÙˆØ¨Øª: Ø³ÙÛŒØ¯
            </div>
        </div>
        
        <div class="chess-container">
            <div class="chess-board">
                <h3 style="text-align: center; margin-bottom: 20px;">ØµÙØ­Ù‡ Ø´Ø·Ø±Ù†Ø¬</h3>
                <div class="board" id="chessBoard">
                    <!-- ØµÙØ­Ù‡ Ø´Ø·Ø±Ù†Ø¬ Ø¨Ø§ JavaScript Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
                
                <div class="player-info">
                    <div class="player player-white">
                        <h4>Ø³ÙÛŒØ¯ (Ø´Ù…Ø§)</h4>
                        <p>Ø§Ù…ØªÛŒØ§Ø²: <span id="whiteScore">0</span></p>
                    </div>
                    <div class="player player-black">
                        <h4>Ø³ÛŒØ§Ù‡ (AI)</h4>
                        <p>Ø§Ù…ØªÛŒØ§Ø²: <span id="blackScore">0</span></p>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <h3>Ú©Ù†ØªØ±Ù„ Ø¨Ø§Ø²ÛŒ</h3>
                
                <button class="btn btn-success" onclick="newGame()">
                    ğŸ†• Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯
                </button>
                
                <button class="btn" onclick="makeAIMove()">
                    ğŸ¤– Ø­Ø±Ú©Øª AI
                </button>
                
                <button class="btn" onclick="undoMove()">
                    â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø­Ø±Ú©Øª
                </button>
                
                <button class="btn btn-danger" onclick="resign()">
                    ğŸ³ï¸ ØªØ³Ù„ÛŒÙ…
                </button>
                
                <button class="btn" onclick="flipBoard()">
                    ğŸ”„ Ú†Ø±Ø®Ø´ ØµÙØ­Ù‡
                </button>
                
                <div style="margin: 20px 0;">
                    <h4>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø·Ø­ AI</h4>
                    <select id="aiLevel" style="width: 100%; padding: 10px; border-radius: 8px; background: #333; color: white;">
                        <option value="1">Ø³Ø·Ø­ Û± (Ø¢Ø³Ø§Ù†)</option>
                        <option value="2">Ø³Ø·Ø­ Û² (Ù…ØªÙˆØ³Ø·)</option>
                        <option value="3" selected>Ø³Ø·Ø­ Û³ (Ø³Ø®Øª)</option>
                        <option value="4">Ø³Ø·Ø­ Û´ (Ø§Ø³ØªØ§Ø¯)</option>
                        <option value="5">Ø³Ø·Ø­ Ûµ (Ú¯Ø±Ù†Ø¯Ù…Ø³ØªØ±)</option>
                    </select>
                </div>
                
                <div class="move-history">
                    <h4>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø­Ø±Ú©Ø§Øª</h4>
                    <div id="moveList">
                        <!-- Ø­Ø±Ú©Ø§Øª Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <h4>ğŸ’ Ø§Ø´ØªØ±Ø§Ú© ÙˆÛŒÚ˜Ù‡</h4>
                    <p>Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ AI Ù‚ÙˆÛŒâ€ŒØªØ± Ùˆ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡:</p>
                    <button class="btn" style="background: linear-gradient(45deg, #f8961e, #f3722c);" 
                            onclick="window.open('/api/marketplace', '_blank')">
                        ğŸ”“ Ø§Ø±ØªÙ‚Ø§ Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
                    </button>
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 30px; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 10px;">
            <h3>â™Ÿï¸ Ø¢Ù…ÙˆØ²Ø´ Ø³Ø±ÛŒØ¹</h3>
            <p>1. Ø±ÙˆÛŒ Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆÙ†Ø¯</p>
            <p>2. Ø±ÙˆÛŒ Ø®Ø§Ù†Ù‡ Ù…Ù‚ØµØ¯ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p>
            <p>3. Ø§Ø² Ø¯Ú©Ù…Ù‡ "Ø­Ø±Ú©Øª AI" Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ¨Øª Ø­Ø±ÛŒÙ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯</p>
            <p>4. Ø¨Ø§Ø²ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø§ Ø¯ÙˆØ³ØªØ§Ù† Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯</p>
        </div>
    </div>
    
    <script>
        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø²ÛŒ
        let gameState = {
            board: [],
            selectedSquare: null,
            currentPlayer: 'white',
            moves: [],
            isFlipped: false,
            whiteScore: 0,
            blackScore: 0,
            aiLevel: 3
        };
        
        // Ù‚Ø·Ø¹Ø§Øª Ø´Ø·Ø±Ù†Ø¬ Ø¨Ø§ emoji
        const pieces = {
            'r': 'â™œ', 'n': 'â™', 'b': 'â™', 'q': 'â™›', 'k': 'â™š', 'p': 'â™Ÿ',
            'R': 'â™–', 'N': 'â™˜', 'B': 'â™—', 'Q': 'â™•', 'K': 'â™”', 'P': 'â™™',
            '': ''
        };
        
        // Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ø±ÙˆØ¹
        const initialBoard = [
            ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
            ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
            ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
        ];
        
        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        function initGame() {
            gameState.board = JSON.parse(JSON.stringify(initialBoard));
            gameState.selectedSquare = null;
            gameState.currentPlayer = 'white';
            gameState.moves = [];
            updateBoard();
            updateStatus();
            updateMoveHistory();
            document.getElementById('aiLevel').value = gameState.aiLevel;
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØµÙØ­Ù‡
        function updateBoard() {
            const boardElement = document.getElementById('chessBoard');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    
                    // Ú†Ø±Ø®Ø´ ØµÙØ­Ù‡
                    const displayRow = gameState.isFlipped ? 7 - row : row;
                    const displayCol = gameState.isFlipped ? 7 - col : col;
                    
                    const piece = gameState.board[displayRow][displayCol];
                    square.textContent = pieces[piece] || '';
                    
                    // Ø±Ù†Ú¯ Ù…Ù‡Ø±Ù‡
                    if (piece === piece.toUpperCase() && piece !== '') {
                        square.style.color = '#ffffff';
                        square.style.textShadow = '1px 1px 2px #000';
                    } else if (piece !== '') {
                        square.style.color = '#000000';
                        square.style.textShadow = '1px 1px 2px #fff';
                    }
                    
                    // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø±Ø¨Ø¹
                    square.onclick = () => handleSquareClick(displayRow, displayCol);
                    
                    // Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ù…Ø±Ø¨Ø¹ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                    if (gameState.selectedSquare && 
                        gameState.selectedSquare.row === displayRow && 
                        gameState.selectedSquare.col === displayCol) {
                        square.classList.add('selected');
                    }
                    
                    boardElement.appendChild(square);
                }
            }
        }
        
        // Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù…Ø±Ø¨Ø¹
        function handleSquareClick(row, col) {
            const piece = gameState.board[row][col];
            
            // Ø§Ú¯Ø± Ù…Ø±Ø¨Ø¹ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
            if (gameState.selectedSquare) {
                const { row: fromRow, col: fromCol } = gameState.selectedSquare;
                
                // Ø§Ú¯Ø± Ø­Ø±Ú©Øª Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª
                if (isValidMove(fromRow, fromCol, row, col)) {
                    // Ø§Ù†Ø¬Ø§Ù… Ø­Ø±Ú©Øª
                    movePiece(fromRow, fromCol, row, col);
                    
                    // Ø«Ø¨Øª Ø­Ø±Ú©Øª
                    const moveNotation = getAlgebraicNotation(fromRow, fromCol, row, col);
                    gameState.moves.push({
                        from: { row: fromRow, col: fromCol },
                        to: { row, col },
                        piece: gameState.board[row][col],
                        notation: moveNotation,
                        player: gameState.currentPlayer
                    });
                    
                    // ØªØºÛŒÛŒØ± Ù†ÙˆØ¨Øª
                    gameState.currentPlayer = gameState.currentPlayer === 'white' ? 'black' : 'white';
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                    updateBoard();
                    updateStatus();
                    updateMoveHistory();
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ
                    checkGameEnd();
                }
                
                // Ù„ØºÙˆ Ø§Ù†ØªØ®Ø§Ø¨
                gameState.selectedSquare = null;
                updateBoard();
            } 
            // Ø§Ú¯Ø± Ù…Ù‡Ø±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
            else if (piece !== '' && 
                     ((gameState.currentPlayer === 'white' && piece === piece.toUpperCase()) ||
                      (gameState.currentPlayer === 'black' && piece === piece.toLowerCase()))) {
                gameState.selectedSquare = { row, col };
                updateBoard();
            }
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø­Ø±Ú©Øª Ù…Ø¹ØªØ¨Ø± (Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡)
        function isValidMove(fromRow, fromCol, toRow, toCol) {
            const piece = gameState.board[fromRow][fromCol];
            const target = gameState.board[toRow][toCol];
            
            // Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø±ÙˆÛŒ Ù…Ù‡Ø±Ù‡ Ø®ÙˆØ¯ÛŒ Ø¨Ø§ÛŒØ³ØªØ¯
            if (target !== '' && 
                ((piece === piece.toUpperCase() && target === target.toUpperCase()) ||
                 (piece === piece.toLowerCase() && target === target.toLowerCase()))) {
                return false;
            }
            
            // Ø­Ø±Ú©Øª Ø³Ø§Ø¯Ù‡ Ù¾ÛŒØ§Ø¯Ù‡
            if (piece.toLowerCase() === 'p') {
                const direction = piece === 'P' ? -1 : 1;
                const startRow = piece === 'P' ? 6 : 1;
                
                // Ø­Ø±Ú©Øª Ù…Ø³ØªÙ‚ÛŒÙ…
                if (fromCol === toCol) {
                    // ÛŒÚ© Ø®Ø§Ù†Ù‡ Ø¨Ù‡ Ø¬Ù„Ùˆ
                    if (toRow === fromRow + direction && target === '') {
                        return true;
                    }
                    // Ø¯Ùˆ Ø®Ø§Ù†Ù‡ Ø¯Ø± Ø´Ø±ÙˆØ¹
                    if (fromRow === startRow && toRow === fromRow + 2 * direction && 
                        target === '' && gameState.board[fromRow + direction][fromCol] === '') {
                        return true;
                    }
                }
                // Ø¶Ø±Ø¨ Ø§Ø±ÛŒØ¨
                else if (Math.abs(fromCol - toCol) === 1 && toRow === fromRow + direction && 
                        target !== '' && 
                        ((piece === 'P' && target === target.toLowerCase()) ||
                         (piece === 'p' && target === target.toUpperCase()))) {
                    return true;
                }
            }
            
            // Ø­Ø±Ú©Øª Ø³Ø§Ø¯Ù‡ Ø§Ø³Ø¨
            if (piece.toLowerCase() === 'n') {
                const rowDiff = Math.abs(fromRow - toRow);
                const colDiff = Math.abs(fromCol - toCol);
                return (rowDiff === 2 && colDiff === 1) || (rowDiff === 1 && colDiff === 2);
            }
            
            // Ø­Ø±Ú©Øª Ø³Ø§Ø¯Ù‡ Ø´Ø§Ù‡
            if (piece.toLowerCase() === 'k') {
                return Math.abs(fromRow - toRow) <= 1 && Math.abs(fromCol - toCol) <= 1;
            }
            
            // Ø­Ø±Ú©Øª Ø³Ø§Ø¯Ù‡ ÙÛŒÙ„
            if (piece.toLowerCase() === 'b') {
                return Math.abs(fromRow - toRow) === Math.abs(fromCol - toCol) && 
                       isPathClear(fromRow, fromCol, toRow, toCol);
            }
            
            // Ø­Ø±Ú©Øª Ø³Ø§Ø¯Ù‡ Ø±Ø®
            if (piece.toLowerCase() === 'r') {
                return (fromRow === toRow || fromCol === toCol) && 
                       isPathClear(fromRow, fromCol, toRow, toCol);
            }
            
            // Ø­Ø±Ú©Øª Ø³Ø§Ø¯Ù‡ ÙˆØ²ÛŒØ±
            if (piece.toLowerCase() === 'q') {
                return (Math.abs(fromRow - toRow) === Math.abs(fromCol - toCol) || 
                       (fromRow === toRow || fromCol === toCol)) && 
                       isPathClear(fromRow, fromCol, toRow, toCol);
            }
            
            return false;
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø³ÛŒØ± Ø¨Ø§Ø²
        function isPathClear(fromRow, fromCol, toRow, toCol) {
            const rowStep = fromRow === toRow ? 0 : (toRow > fromRow ? 1 : -1);
            const colStep = fromCol === toCol ? 0 : (toCol > fromCol ? 1 : -1);
            
            let row = fromRow + rowStep;
            let col = fromCol + colStep;
            
            while (row !== toRow || col !== toCol) {
                if (gameState.board[row][col] !== '') {
                    return false;
                }
                row += rowStep;
                col += colStep;
            }
            
            return true;
        }
        
        // Ø­Ø±Ú©Øª Ù…Ù‡Ø±Ù‡
        function movePiece(fromRow, fromCol, toRow, toCol) {
            gameState.board[toRow][toCol] = gameState.board[fromRow][fromCol];
            gameState.board[fromRow][fromCol] = '';
        }
        
        // Ù†Ù…Ø§Ø¯ Ø¬Ø¨Ø±ÛŒ Ø­Ø±Ú©Øª
        function getAlgebraicNotation(fromRow, fromCol, toRow, toCol) {
            const files = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];
            const ranks = ['8', '7', '6', '5', '4', '3', '2', '1'];
            
            const fileFrom = files[fromCol];
            const rankFrom = ranks[fromRow];
            const fileTo = files[toCol];
            const rankTo = ranks[toRow];
            
            return `${fileFrom}${rankFrom}${fileTo}${rankTo}`;
        }
        
        // Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯
        function newGame() {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯ØŸ')) {
                gameState.whiteScore = 0;
                gameState.blackScore = 0;
                initGame();
                document.getElementById('whiteScore').textContent = '0';
                document.getElementById('blackScore').textContent = '0';
            }
        }
        
        // Ø­Ø±Ú©Øª AI
        function makeAIMove() {
            if (gameState.currentPlayer !== 'black') {
                alert('Ù†ÙˆØ¨Øª Ø´Ù…Ø§ Ù†ÛŒØ³Øª!');
                return;
            }
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ AI (ØªØµØ§Ø¯ÙÛŒ)
            const possibleMoves = [];
            
            for (let fromRow = 0; fromRow < 8; fromRow++) {
                for (let fromCol = 0; fromCol < 8; fromCol++) {
                    const piece = gameState.board[fromRow][fromCol];
                    if (piece !== '' && piece === piece.toLowerCase()) { // Ù…Ù‡Ø±Ù‡ Ø³ÛŒØ§Ù‡
                        for (let toRow = 0; toRow < 8; toRow++) {
                            for (let toCol = 0; toCol < 8; toCol++) {
                                if (isValidMove(fromRow, fromCol, toRow, toCol)) {
                                    possibleMoves.push({ fromRow, fromCol, toRow, toCol });
                                }
                            }
                        }
                    }
                }
            }
            
            if (possibleMoves.length > 0) {
                // Ø§Ù†ØªØ®Ø§Ø¨ Ø­Ø±Ú©Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø·Ø­ AI
                const aiLevel = parseInt(document.getElementById('aiLevel').value);
                let move;
                
                if (aiLevel <= 2) {
                    // AI Ø¢Ø³Ø§Ù†: Ø­Ø±Ú©Øª ØªØµØ§Ø¯ÙÛŒ
                    move = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                } else {
                    // AI Ø³Ø®Øª: Ø­Ø±Ú©Øª Ø¨Ù‡ Ø³Ù…Øª Ù…Ø±Ú©Ø² ÛŒØ§ Ú¯Ø±ÙØªÙ† Ù…Ù‡Ø±Ù‡
                    move = possibleMoves[0];
                    let bestScore = -Infinity;
                    
                    possibleMoves.forEach(m => {
                        const target = gameState.board[m.toRow][m.toCol];
                        let score = 0;
                        
                        // Ø§Ø±Ø²Ø´ Ú¯Ø±ÙØªÙ† Ù…Ù‡Ø±Ù‡
                        if (target !== '' && target === target.toUpperCase()) {
                            const pieceValues = { 'p': 1, 'n': 3, 'b': 3, 'r': 5, 'q': 9, 'k': 0 };
                            score += pieceValues[target.toLowerCase()] * 10;
                        }
                        
                        // Ø­Ø±Ú©Øª Ø¨Ù‡ Ù…Ø±Ú©Ø²
                        const centerDist = Math.abs(m.toRow - 3.5) + Math.abs(m.toCol - 3.5);
                        score += (14 - centerDist);
                        
                        if (score > bestScore) {
                            bestScore = score;
                            move = m;
                        }
                    });
                }
                
                // Ø§Ù†Ø¬Ø§Ù… Ø­Ø±Ú©Øª AI
                movePiece(move.fromRow, move.fromCol, move.toRow, move.toCol);
                
                // Ø«Ø¨Øª Ø­Ø±Ú©Øª
                const moveNotation = getAlgebraicNotation(move.fromRow, move.fromCol, move.toRow, move.toCol);
                gameState.moves.push({
                    from: { row: move.fromRow, col: move.fromCol },
                    to: { row: move.toRow, col: move.toCol },
                    piece: gameState.board[move.toRow][move.toCol],
                    notation: moveNotation,
                    player: 'black'
                });
                
                // ØªØºÛŒÛŒØ± Ù†ÙˆØ¨Øª
                gameState.currentPlayer = 'white';
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                updateBoard();
                updateStatus();
                updateMoveHistory();
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ
                checkGameEnd();
            }
        }
        
        // Ø¨Ø§Ø²Ú¯Ø´Øª Ø­Ø±Ú©Øª
        function undoMove() {
            if (gameState.moves.length > 0) {
                const lastMove = gameState.moves.pop();
                gameState.board[lastMove.from.row][lastMove.from.col] = lastMove.piece;
                gameState.board[lastMove.to.row][lastMove.to.col] = '';
                gameState.currentPlayer = lastMove.player;
                
                updateBoard();
                updateStatus();
                updateMoveHistory();
            }
        }
        
        // ØªØ³Ù„ÛŒÙ…
        function resign() {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªØ³Ù„ÛŒÙ… Ø´ÙˆÛŒØ¯ØŸ')) {
                if (gameState.currentPlayer === 'white') {
                    gameState.blackScore++;
                    document.getElementById('blackScore').textContent = gameState.blackScore;
                    alert('Ø´Ù…Ø§ ØªØ³Ù„ÛŒÙ… Ø´Ø¯ÛŒØ¯! AI Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯.');
                } else {
                    gameState.whiteScore++;
                    document.getElementById('whiteScore').textContent = gameState.whiteScore;
                    alert('AI ØªØ³Ù„ÛŒÙ… Ø´Ø¯! Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯ÛŒØ¯.');
                }
                initGame();
            }
        }
        
        // Ú†Ø±Ø®Ø´ ØµÙØ­Ù‡
        function flipBoard() {
            gameState.isFlipped = !gameState.isFlipped;
            updateBoard();
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª
        function updateStatus() {
            const status = document.getElementById('gameStatus');
            status.innerHTML = `
                <strong>ÙˆØ¶Ø¹ÛŒØª:</strong> ${gameState.moves.length === 0 ? 'Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯' : 'Ø¯Ø± Ø¬Ø±ÛŒØ§Ù†'} | 
                <strong>Ù†ÙˆØ¨Øª:</strong> ${gameState.currentPlayer === 'white' ? 'Ø³ÙÛŒØ¯ (Ø´Ù…Ø§)' : 'Ø³ÛŒØ§Ù‡ (AI)'} |
                <strong>ØªØ¹Ø¯Ø§Ø¯ Ø­Ø±Ú©Ø§Øª:</strong> ${gameState.moves.length}
            `;
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø­Ø±Ú©Ø§Øª
        function updateMoveHistory() {
            const moveList = document.getElementById('moveList');
            moveList.innerHTML = '';
            
            gameState.moves.forEach((move, index) => {
                const moveItem = document.createElement('div');
                moveItem.className = 'move-item';
                moveItem.innerHTML = `
                    <strong>${index + 1}.</strong> 
                    ${move.player === 'white' ? 'âšª' : 'âš«'} 
                    ${move.notation}
                `;
                moveList.appendChild(moveItem);
            });
            
            // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
            moveList.scrollTop = moveList.scrollHeight;
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ
        function checkGameEnd() {
            // Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ù†Ø·Ù‚ Ú©Ø§Ù…Ù„ Ø´Ø·Ø±Ù†Ø¬ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
            // Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ø³Ø§Ø¯Ù‡ØŒ ÙÙ‚Ø· Ø­Ø±Ú©Øª Ø±Ø§ Ø«Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
        }
        
        // API Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±
        async function saveGame() {
            try {
                const response = await fetch('/api/chess/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(gameState)
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø§Ø²ÛŒ:', error);
            }
        }
        
        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        window.onload = function() {
            initGame();
            console.log('â™” Ø´Ø·Ø±Ù†Ø¬ ØªØªØ±Ø§Ø´Ø§Ù¾ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯!');
        };
    </script>
</body>
</html>
