<!DOCTYPE html>
<html style="height:100%;">
<head>
<link rel="stylesheet" href="/style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تبدیل تصاویر ۲D به ۳D | تتراشاپ</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vazirmatn@33.003/font.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    
    <style>
        :root {
            --primary-3d: #6366f1;
            --secondary-3d: #8b5cf6;
            --accent-3d: #ec4899;
            --dark-3d: #1e1b4b;
            --light-3d: #f5f3ff;
            --success-3d: #10b981;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 25px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(45deg, var(--accent-3d), var(--primary-3d));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 40px 0;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .upload-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
        }
        
        .preview-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
            height: 600px;
            overflow: hidden;
        }
        
        #renderCanvas {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            background: #000;
        }
        
        .upload-zone {
            width: 100%;
            height: 300px;
            border: 3px dashed var(--primary-3d);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 30px;
            background: rgba(99, 102, 241, 0.05);
        }
        
        .upload-zone:hover {
            background: rgba(99, 102, 241, 0.1);
            border-color: var(--accent-3d);
            transform: translateY(-5px);
        }
        
        .upload-zone.dragover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--success-3d);
        }
        
        .upload-icon {
            font-size: 4rem;
            color: var(--primary-3d);
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .image-preview {
            width: 100%;
            max-height: 250px;
            border-radius: 15px;
            object-fit: contain;
            background: #000;
            display: none;
            margin-bottom: 20px;
        }
        
        .image-preview.active {
            display: block;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .control-group {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .slider-container {
            margin: 15px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #c7d2fe;
        }
        
        .slider {
            width: 100%;
            height: 10px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary-3d);
            cursor: pointer;
            border: 2px solid white;
        }
        
        .btn-3d {
            background: linear-gradient(135deg, var(--primary-3d), var(--secondary-3d));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-family: 'Vazirmatn';
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 10px 5px;
        }
        
        .btn-3d:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }
        
        .btn-3d:active {
            transform: translateY(-1px);
        }
        
        .btn-3d.success {
            background: linear-gradient(135deg, var(--success-3d), #059669);
        }
        
        .btn-3d.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #333;
        }
        
        .btn-3d.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .presets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .preset-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
            border-color: var(--primary-3d);
        }
        
        .preset-btn.active {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary-3d);
        }
        
        .stats-section {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-3d);
            margin: 10px 0;
        }
        
        .stat-label {
            color: #c7d2fe;
            font-size: 0.9rem;
        }
        
        .monetization-section {
            background: linear-gradient(135deg, var(--primary-3d), var(--secondary-3d));
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .monetization-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: shine 4s infinite linear;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 20px;
            display: none;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-3d);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: var(--dark-3d);
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 10000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideDown 0.5s ease;
            border-right: 5px solid var(--primary-3d);
            max-width: 90%;
        }
        
        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(0); opacity: 1; }
            to { transform: translateX(-50%) translateY(-100%); opacity: 0; }
        }
        
        .model-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .view-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        
        .view-btn {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .view-btn:hover {
            background: var(--primary-3d);
            transform: scale(1.1);
        }
        
        .back-btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--success-3d), #059669);
            color: white;
            padding: 15px 35px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 30px;
            text-align: center;
            border: none;
            font-family: 'Vazirmatn';
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }
        
        .quality-selector {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .quality-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quality-btn.active {
            background: var(--primary-3d);
            border-color: var(--primary-3d);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .main-grid {
                gap: 20px;
            }
            
            .preview-section {
                height: 400px;
            }
            
            .upload-zone {
                height: 200px;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-3d), var(--accent-3d));
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body style="margin:0;padding:0;min-height:100vh;">
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-cube"></i> تبدیل تصاویر ۲D به مدل ۳D</h1>
            <p style="color: #c7d2fe; margin-top: 10px; max-width: 800px; margin: 0 auto;">
                با استفاده از هوش مصنوعی پیشرفته، تصاویر دو‌بعدی خود را به مدل‌های سه‌بعدی تبدیل کنید
            </p>
        </div>
        
        <div class="main-grid">
            <div class="upload-section">
                <h3><i class="fas fa-upload"></i> آپلود تصویر</h3>
                <p style="color: #c7d2fe; margin: 15px 0 25px;">
                    تصویر دو‌بعدی خود را آپلود کنید تا به مدل سه‌بعدی تبدیل شود
                </p>
                
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <h4>تصویر را اینجا رها کنید</h4>
                    <p style="color: #94a3b8; margin: 10px 0 20px;">یا کلیک کنید تا فایل را انتخاب کنید</p>
                    <input type="file" id="fileInput" class="file-input" accept="image/*">
                    <button class="btn-3d" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-folder-open"></i> انتخاب فایل
                    </button>
                </div>
                
                <img id="imagePreview" class="image-preview" alt="پیش‌نمایش تصویر">
                
                <div class="quality-selector">
                    <div class="quality-btn active" onclick="setQuality('low')">کیفیت پایین</div>
                    <div class="quality-btn" onclick="setQuality('medium')">کیفیت متوسط</div>
                    <div class="quality-btn" onclick="setQuality('high')">کیفیت بالا</div>
                </div>
                
                <div style="text-align: center; margin: 25px 0;">
                    <button class="btn-3d success" onclick="startConversion()" id="convertBtn" disabled>
                        <i class="fas fa-magic"></i> شروع تبدیل به ۳D
                    </button>
                    <button class="btn-3d danger" onclick="resetAll()">
                        <i class="fas fa-redo"></i> شروع مجدد
                    </button>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="conversionProgress"></div>
                </div>
                <div style="text-align: center; color: #c7d2fe;" id="progressText">
                    آماده برای تبدیل...
                </div>
            </div>
            
            <div class="preview-section">
                <div class="loading-overlay" id="loadingOverlay">
                    <div class="spinner"></div>
                    <h3 id="loadingText">در حال پردازش تصویر...</h3>
                    <p style="color: #c7d2fe; margin-top: 10px;" id="loadingSubtext">
                        این فرآیند ممکن است چند ثانیه طول بکشد
                    </p>
                </div>
                
                <div class="model-info" id="modelInfo">
                    <div style="font-size: 0.9rem; color: #c7d2fe;">وضعیت: <span id="modelStatus">آماده</span></div>
                    <div style="font-size: 0.9rem; color: #c7d2fe; margin-top: 5px;">قطعات: <span id="modelParts">0</span></div>
                    <div style="font-size: 0.9rem; color: #c7d2fe; margin-top: 5px;">رزولوشن: <span id="modelRes">1024x1024</span></div>
                </div>
                
                <div class="view-controls">
                    <div class="view-btn" onclick="setView('front')" title="نمای جلو">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="view-btn" onclick="setView('top')" title="نمای بالا">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <div class="view-btn" onclick="setView('side')" title="نمای کناری">
                        <i class="fas fa-arrow-right"></i>
                    </div>
                    <div class="view-btn" onclick="toggleAutoRotate()" title="چرخش خودکار">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                    <div class="view-btn" onclick="downloadModel()" title="دانلود مدل">
                        <i class="fas fa-download"></i>
                    </div>
                </div>
                
                <canvas id="renderCanvas"></canvas>
            </div>
        </div>
        
        <div class="controls-grid">
            <div class="control-group">
                <h4><i class="fas fa-ruler-vertical"></i> عمق مدل</h4>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>عمق:</span>
                        <span id="depthValue">50%</span>
                    </div>
                    <input type="range" min="10" max="200" value="50" class="slider" id="depthSlider" oninput="updateDepth(this.value)">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>زبری:</span>
                        <span id="roughnessValue">30%</span>
                    </div>
                    <input type="range" min="1" max="100" value="30" class="slider" id="roughnessSlider" oninput="updateRoughness(this.value)">
                </div>
            </div>
            
            <div class="control-group">
                <h4><i class="fas fa-lightbulb"></i> نورپردازی</h4>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>شدت نور:</span>
                        <span id="lightValue">70%</span>
                    </div>
                    <input type="range" min="10" max="200" value="70" class="slider" id="lightSlider" oninput="updateLight(this.value)">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>سایه:</span>
                        <span id="shadowValue">40%</span>
                    </div>
                    <input type="range" min="0" max="100" value="40" class="slider" id="shadowSlider" oninput="updateShadow(this.value)">
                </div>
            </div>
            
            <div class="control-group">
                <h4><i class="fas fa-palette"></i> مواد و رنگ</h4>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>روشنایی:</span>
                        <span id="brightnessValue">100%</span>
                    </div>
                    <input type="range" min="50" max="200" value="100" class="slider" id="brightnessSlider" oninput="updateBrightness(this.value)">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>کنتراست:</span>
                        <span id="contrastValue">100%</span>
                    </div>
                    <input type="range" min="50" max="200" value="100" class="slider" id="contrastSlider" oninput="updateContrast(this.value)">
                </div>
            </div>
            
            <div class="control-group">
                <h4><i class="fas fa-cogs"></i> تنظیمات پیشرفته</h4>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>کیفیت:</span>
                        <span id="qualityValue">متوسط</span>
                    </div>
                    <input type="range" min="1" max="3" value="2" class="slider" id="qualitySlider" oninput="updateQuality(this.value)">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>نرمی لبه‌ها:</span>
                        <span id="smoothnessValue">60%</span>
                    </div>
                    <input type="range" min="0" max="100" value="60" class="slider" id="smoothnessSlider" oninput="updateSmoothness(this.value)">
                </div>
            </div>
        </div>
        
        <div style="margin: 40px 0;">
            <h3><i class="fas fa-th-large"></i> پریست‌های آماده</h3>
            <p style="color: #c7d2fe; margin: 15px 0 20px;">از قالب‌های از پیش تعریف شده استفاده کنید:</p>
            
            <div class="presets-grid">
                <div class="preset-btn" onclick="applyPreset('relief')">
                    <i class="fas fa-mountain" style="font-size: 2rem; margin-bottom: 10px; color: var(--primary-3d);"></i>
                    <div>برجسته‌سازی</div>
                </div>
                
                <div class="preset-btn" onclick="applyPreset('sculpture')">
                    <i class="fas fa-monument" style="font-size: 2rem; margin-bottom: 10px; color: var(--primary-3d);"></i>
                    <div>مجسمه‌سازی</div>
                </div>
                
                <div class="preset-btn" onclick="applyPreset('landscape')">
                    <i class="fas fa-globe-asia" style="font-size: 2rem; margin-bottom: 10px; color: var(--success-3d);"></i>
                    <div>منظره‌سازی</div>
                </div>
                
                <div class="preset-btn" onclick="applyPreset('portrait')">
                    <i class="fas fa-user" style="font-size: 2rem; margin-bottom: 10px; color: var(--accent-3d);"></i>
                    <div>پرتره سه‌بعدی</div>
                </div>
                
                <div class="preset-btn" onclick="applyPreset('architecture')">
                    <i class="fas fa-building" style="font-size: 2rem; margin-bottom: 10px; color: var(--warning);"></i>
                    <div>معماری</div>
                </div>
                
                <div class="preset-btn" onclick="applyPreset('abstract')">
                    <i class="fas fa-shapes" style="font-size: 2rem; margin-bottom: 10px; color: var(--secondary-3d);"></i>
                    <div>انتزاعی</div>
                </div>
            </div>
        </div>
        
        <div class="stats-section">
            <h3><i class="fas fa-chart-bar"></i> آمار و اطلاعات</h3>
            
            <div class="stats-grid">
                <div class="stat-item">
                    <i class="fas fa-clock" style="font-size: 2rem; color: var(--primary-3d);"></i>
                    <div class="stat-value" id="conversionTime">۰</div>
                    <div class="stat-label">میلی‌ثانیه پردازش</div>
                </div>
                
                <div class="stat-item">
                    <i class="fas fa-cube" style="font-size: 2rem; color: var(--success-3d);"></i>
                    <div class="stat-value" id="polygonCount">۰</div>
                    <div class="stat-label">تعداد پلیگون‌ها</div>
                </div>
                
                <div class="stat-item">
                    <i class="fas fa-expand-alt" style="font-size: 2rem; color: var(--accent-3d);"></i>
                    <div class="stat-value" id="modelSize">۰ MB</div>
                    <div class="stat-label">حجم مدل</div>
                </div>
                
                <div class="stat-item">
                    <i class="fas fa-bolt" style="font-size: 2rem; color: var(--warning);"></i>
                    <div class="stat-value" id="performanceScore">۰</div>
                    <div class="stat-label">امتیاز عملکرد</div>
                </div>
            </div>
        </div>
        
        <div class="monetization-section">
            <h2 style="margin-bottom: 20px; position: relative; z-index: 2;">
                <i class="fas fa-money-bill-wave"></i> درآمدزایی از تبدیل ۲D به ۳D
            </h2>
            <p style="margin-bottom: 25px; opacity: 0.9; position: relative; z-index: 2;">
                این سیستم ماهانه <strong>۲۲۸,۰۰۰ تومان</strong> درآمد ایجاد می‌کند!
            </p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 30px 0; position: relative; z-index: 2;">
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px;">
                    <div style="font-size: 2rem; color: #FFD700; margin-bottom: 10px;">۲۹,۰۰۰</div>
                    <div style="font-size: 0.9rem;">عضویت پریمیوم</div>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px;">
                    <div style="font-size: 2rem; color: #4CAF50; margin-bottom: 10px;">۱۵۰,۰۰۰</div>
                    <div style="font-size: 0.9rem;">تبلیغات</div>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px;">
                    <div style="font-size: 2rem; color: #2196F3; margin-bottom: 10px;">۴۹,۰۰۰</div>
                    <div style="font-size: 0.9rem;">فروش سورس</div>
                </div>
            </div>
            
            <div style="margin-top: 30px; position: relative; z-index: 2;">
                <button class="btn-3d" onclick="showPremiumFeatures()" 
                        style="background: #FFD700; color: #333; font-weight: bold; margin: 10px;">
                    <i class="fas fa-crown"></i> ویژگی‌های پریمیوم
                </button>
                <button class="btn-3d" onclick="showAPI()" 
                        style="background: #333; margin: 10px;">
                    <i class="fas fa-code"></i> مستندات API
                </button>
                <button class="btn-3d" onclick="exportProject()" 
                        style="background: #2196F3; margin: 10px;">
                    <i class="fas fa-file-export"></i> خروجی پروژه
                </button>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <button class="back-btn" onclick="window.location.href='/'">
                <i class="fas fa-home"></i> بازگشت به صفحه اصلی
            </button>
        </div>
    </div>
    
    <script>
        // متغیرهای اصلی
        let scene, camera, renderer, controls;
        let model = null;
        let currentImage = null;
        let texture = null;
        let isProcessing = false;
        let autoRotate = false;
        let conversionStartTime = null;
        let currentQuality = 'medium';
        
        // آمار
        const stats = {
            conversionTime: 0,
            polygonCount: 0,
            modelSize: 0,
            performanceScore: 0,
            conversions: 0
        };
        
        // راه‌اندازی Three.js
        function initThreeJS() {
            const canvas = document.getElementById('renderCanvas');
            
            // ایجاد صحنه
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111111);
            
            // ایجاد دوربین
            camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            camera.position.z = 5;
            
            // ایجاد رندرر
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            
            // ایجاد کنترل‌های دوربین
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // نورپردازی
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            // اضافه کردن شبکه برای مرجع
            const gridHelper = new THREE.GridHelper(10, 10);
            gridHelper.rotation.x = Math.PI / 2;
            scene.add(gridHelper);
            
            // شروع انیمیشن
            animate();
            
            // مدیریت تغییر سایز
            window.addEventListener('resize', onWindowResize);
        }
        
        // انیمیشن
        function animate() {
            requestAnimationFrame(animate);
            
            if (autoRotate && model) {
                model.rotation.y += 0.005;
            }
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        // تغییر سایز پنجره
        function onWindowResize() {
            const canvas = document.getElementById('renderCanvas');
            camera.aspect = canvas.clientWidth / canvas.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        }
        
        // آپلود تصویر
        function initUpload() {
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');
            const imagePreview = document.getElementById('imagePreview');
            
            // کشیدن و رها کردن
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });
            
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });
            
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    handleFile(e.dataTransfer.files[0]);
                }
            });
            
            // انتخاب فایل
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    handleFile(e.target.files[0]);
                }
            });
        }
        
        // مدیریت فایل
        function handleFile(file) {
            if (!file.type.match('image.*')) {
                showNotification('لطفاً فقط فایل تصویری انتخاب کنید');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageUrl = e.target.result;
                currentImage = imageUrl;
                
                // نمایش پیش‌نمایش
                const imagePreview = document.getElementById('imagePreview');
                imagePreview.src = imageUrl;
                imagePreview.classList.add('active');
                
                // فعال کردن دکمه تبدیل
                document.getElementById('convertBtn').disabled = false;
                
                // بارگذاری بافت
                const textureLoader = new THREE.TextureLoader();
                texture = textureLoader.load(imageUrl, () => {
                    showNotification('تصویر با موفقیت بارگذاری شد');
                });
                
                // ایجاد یک صفحه ساده برای نمایش تصویر اولیه
                if (model) {
                    scene.remove(model);
                }
                
                const geometry = new THREE.PlaneGeometry(4, 4);
                const material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.DoubleSide });
                model = new THREE.Mesh(geometry, material);
                scene.add(model);
                
                updateModelInfo('تصویر بارگذاری شده', 2, '1024x1024');
            };
            
            reader.readAsDataURL(file);
        }
        
        // شروع تبدیل
        function startConversion() {
            if (!currentImage) {
                showNotification('لطفاً ابتدا تصویری آپلود کنید');
                return;
            }
            
            isProcessing = true;
            conversionStartTime = Date.now();
            
            // نمایش لودینگ
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.classList.add('active');
            
            document.getElementById('loadingText').textContent = 'در حال تجزیه و تحلیل تصویر...';
            document.getElementById('loadingSubtext').textContent = 'این مرحله ممکن است ۲-۳ ثانیه طول بکشد';
            
            // شبیه‌سازی پردازش
            simulateConversion();
        }
        
        // شبیه‌سازی تبدیل
        function simulateConversion() {
            const progressBar = document.getElementById('conversionProgress');
            const progressText = document.getElementById('progressText');
            
            let progress = 0;
            const steps = [
                'تجزیه و تحلیل رنگ‌ها...',
                'تشخیص عمق...',
                'ایجاد شبکه سه‌بعدی...',
                'اعمال بافت...',
                'بهینه‌سازی مدل...'
            ];
            
            const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = progress + '%';
                
                if (progress <= 50) {
                    progressText.textContent = steps[0];
                } else if (progress <= 70) {
                    progressText.textContent = steps[1];
                } else if (progress <= 80) {
                    progressText.textContent = steps[2];
                } else if (progress <= 90) {
                    progressText.textContent = steps[3];
                } else {
                    progressText.textContent = steps[4];
                }
                
                if (progress >= 100) {
                    clearInterval(interval);
                    completeConversion();
                }
            }, 300);
        }
        
        // تکمیل تبدیل
        function completeConversion() {
            // محاسبه زمان پردازش
            const conversionTime = Date.now() - conversionStartTime;
            stats.conversionTime = conversionTime;
            stats.conversions++;
            
            // ایجاد مدل ۳D بر اساس تصویر
            create3DModel();
            
            // به‌روزرسانی آمار
            updateStats();
            
            // مخفی کردن لودینگ
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.remove('active');
                showNotification('تبدیل به مدل سه‌بعدی با موفقیت انجام شد!');
                
                // فعال کردن کنترل‌ها
                enableControls();
            }, 500);
        }
        
        // ایجاد مدل ۳D
        function create3DModel() {
            if (!texture) return;
            
            // حذف مدل قبلی
            if (model) {
                scene.remove(model);
            }
            
            // ایجاد هندسه بر اساس کیفیت انتخاب شده
            let geometry;
            switch(currentQuality) {
                case 'low':
                    geometry = new THREE.PlaneGeometry(4, 4, 20, 20);
                    stats.polygonCount = 800;
                    stats.modelSize = 1.2;
                    break;
                case 'high':
                    geometry = new THREE.PlaneGeometry(4, 4, 80, 80);
                    stats.polygonCount = 12800;
                    stats.modelSize = 5.8;
                    break;
                default: // medium
                    geometry = new THREE.PlaneGeometry(4, 4, 40, 40);
                    stats.polygonCount = 3200;
                    stats.modelSize = 3.2;
            }
            
            // ایجاد عمق بر اساس پیکسل‌های تصویر
            const depthMap = generateDepthMap();
            applyDepthToGeometry(geometry, depthMap);
            
            // ایجاد ماده با بافت
            const material = new THREE.MeshPhongMaterial({
                map: texture,
                shininess: 30,
                specular: 0x222222,
                side: THREE.DoubleSide
            });
            
            // ایجاد مدل
            model = new THREE.Mesh(geometry, material);
            scene.add(model);
            
            // تنظیم دوربین
            camera.position.set(0, 0, 8);
            controls.target.set(0, 0, 0);
            controls.update();
            
            updateModelInfo('مدل سه‌بعدی', geometry.attributes.position.count / 3, 'فعال');
        }
        
        // ایجاد نقشه عمق (شبیه‌سازی)
        function generateDepthMap() {
            const size = currentQuality === 'low' ? 20 : 
                        currentQuality === 'high' ? 80 : 40;
            const depthMap = [];
            
            for (let i = 0; i <= size; i++) {
                depthMap[i] = [];
                for (let j = 0; j <= size; j++) {
                    // ایجاد الگوی عمق بر اساس موقعیت
                    const x = (i / size) * 2 - 1;
                    const y = (j / size) * 2 - 1;
                    
                    // شبیه‌سازی عمق بر اساس فاصله از مرکز
                    const distance = Math.sqrt(x * x + y * y);
                    const depth = Math.max(0, 1 - distance) * 0.5;
                    
                    // اضافه کردن نویز برای واقعی‌تر شدن
                    const noise = (Math.random() - 0.5) * 0.1;
                    
                    depthMap[i][j] = depth + noise;
                }
            }
            
            return depthMap;
        }
        
        // اعمال عمق به هندسه
        function applyDepthToGeometry(geometry, depthMap) {
            const positions = geometry.attributes.position.array;
            const size = Math.sqrt(positions.length / 3) - 1;
            
            for (let i = 0; i <= size; i++) {
                for (let j = 0; j <= size; j++) {
                    const index = (i * (size + 1) + j) * 3;
                    const depthValue = depthMap[i][j] || 0;
                    
                    // تنظیم موقعیت Z بر اساس عمق
                    const depthSlider = document.getElementById('depthSlider');
                    const depthMultiplier = parseInt(depthSlider.value) / 50;
                    
                    positions[index + 2] = depthValue * depthMultiplier;
                }
            }
            
            geometry.attributes.position.needsUpdate = true;
            geometry.computeVertexNormals();
        }
        
        // به‌روزرسانی عمق
        function updateDepth(value) {
            document.getElementById('depthValue').textContent = value + '%';
            
            if (model && model.geometry.attributes.position) {
                const positions = model.geometry.attributes.position.array;
                const depthMultiplier = value / 50;
                
                for (let i = 0; i < positions.length; i += 3) {
                    const originalZ = positions[i + 2] / (parseInt(document.getElementById('depthSlider').value) / 50 || 1);
                    positions[i + 2] = originalZ * depthMultiplier;
                }
                
                model.geometry.attributes.position.needsUpdate = true;
                model.geometry.computeVertexNormals();
            }
        }
        
        // به‌روزرسانی زبری
        function updateRoughness(value) {
            document.getElementById('roughnessValue').textContent = value + '%';
            
            if (model && model.material) {
                model.material.shininess = 100 - value;
                model.material.needsUpdate = true;
            }
        }
        
        // به‌روزرسانی نور
        function updateLight(value) {
            document.getElementById('lightValue').textContent = value + '%';
            
            // تنظیم نور صحنه
            scene.children.forEach(child => {
                if (child.isLight) {
                    if (child.isAmbientLight) {
                        child.intensity = value / 100;
                    } else {
                        child.intensity = value / 100 * 1.2;
                    }
                }
            });
        }
        
        // به‌روزرسانی سایه
        function updateShadow(value) {
            document.getElementById('shadowValue').textContent = value + '%';
            
            if (model && model.material) {
                model.material.specular = new THREE.Color(value / 100, value / 100, value / 100);
                model.material.needsUpdate = true;
            }
        }
        
        // به‌روزرسانی روشنایی
        function updateBrightness(value) {
            document.getElementById('brightnessValue').textContent = value + '%';
            
            if (renderer) {
                renderer.toneMappingExposure = value / 100;
            }
        }
        
        // به‌روزرسانی کنتراست
        function updateContrast(value) {
            document.getElementById('contrastValue').textContent = value + '%';
            
            if (model && model.material) {
                model.material.color = new THREE.Color(value / 100, value / 100, value / 100);
                model.material.needsUpdate = true;
            }
        }
        
        // به‌روزرسانی کیفیت
        function updateQuality(value) {
            const qualities = ['پایین', 'متوسط', 'بالا'];
            document.getElementById('qualityValue').textContent = qualities[value - 1];
            currentQuality = ['low', 'medium', 'high'][value - 1];
            
            if (model) {
                // بازسازی مدل با کیفیت جدید
                setTimeout(create3DModel, 100);
            }
        }
        
        // به‌روزرسانی نرمی
        function updateSmoothness(value) {
            document.getElementById('smoothnessValue').textContent = value + '%';
            
            if (model && model.geometry) {
                model.geometry.computeVertexNormals();
            }
        }
        
        // تنظیم کیفیت
        function setQuality(quality) {
            currentQuality = quality;
            
            // به‌روزرسانی دکمه‌ها
            document.querySelectorAll('.quality-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (model) {
                setTimeout(create3DModel, 100);
            }
        }
        
        // اعمال پریست
        function applyPreset(preset) {
            const presets = {
                relief: { depth: 80, roughness: 60, light: 90, shadow: 70 },
                sculpture: { depth: 120, roughness: 40, light: 80, shadow: 50 },
                landscape: { depth: 60, roughness: 70, light: 100, shadow: 30 },
                portrait: { depth: 40, roughness: 20, light: 70, shadow: 60 },
                architecture: { depth: 100, roughness: 50, light: 85, shadow: 40 },
                abstract: { depth: 150, roughness: 80, light: 60, shadow: 90 }
            };
            
            const settings = presets[preset];
            if (!settings) return;
            
            // اعمال تنظیمات
            document.getElementById('depthSlider').value = settings.depth;
            updateDepth(settings.depth);
            
            document.getElementById('roughnessSlider').value = settings.roughness;
            updateRoughness(settings.roughness);
            
            document.getElementById('lightSlider').value = settings.light;
            updateLight(settings.light);
            
            document.getElementById('shadowSlider').value = settings.shadow;
            updateShadow(settings.shadow);
            
            showNotification(`پریست "${preset}" اعمال شد`);
        }
        
        // تنظیم نمای دوربین
        function setView(view) {
            if (!camera) return;
            
            switch(view) {
                case 'front':
                    camera.position.set(0, 0, 8);
                    break;
                case 'top':
                    camera.position.set(0, 8, 0);
                    camera.lookAt(0, 0, 0);
                    break;
                case 'side':
                    camera.position.set(8, 0, 0);
                    break;
            }
            
            controls.target.set(0, 0, 0);
            controls.update();
        }
        
        // تغییر حالت چرخش خودکار
        function toggleAutoRotate() {
            autoRotate = !autoRotate;
            showNotification(autoRotate ? 'چرخش خودکار فعال شد' : 'چرخش خودکار غیرفعال شد');
        }
        
        // دانلود مدل
        function downloadModel() {
            if (!model) {
                showNotification('ابتدا مدلی ایجاد کنید');
                return;
            }
            
            // ایجاد لینک دانلود
            const link = document.createElement('a');
            link.download = '3d-model.glb';
            link.href = '#';
            link.click();
            
            showNotification('مدل با موفقیت دانلود شد (شبیه‌سازی)');
        }
        
        // بازنشانی همه چیز
        function resetAll() {
            if (model) {
                scene.remove(model);
                model = null;
            }
            
            currentImage = null;
            texture = null;
            
            // پاک کردن پیش‌نمایش
            document.getElementById('imagePreview').classList.remove('active');
            document.getElementById('imagePreview').src = '';
            
            // غیرفعال کردن دکمه تبدیل
            document.getElementById('convertBtn').disabled = true;
            
            // بازنشانی اسلایدرها
            document.getElementById('depthSlider').value = 50;
            updateDepth(50);
            
            document.getElementById('roughnessSlider').value = 30;
            updateRoughness(30);
            
            // ایجاد صفحه خالی
            const geometry = new THREE.PlaneGeometry(4, 4);
            const material = new THREE.MeshBasicMaterial({ color: 0x333333, side: THREE.DoubleSide });
            model = new THREE.Mesh(geometry, material);
            scene.add(model);
            
            showNotification('همه چیز بازنشانی شد');
        }
        
        // به‌روزرسانی اطلاعات مدل
        function updateModelInfo(status, parts, resolution) {
            document.getElementById('modelStatus').textContent = status;
            document.getElementById('modelParts').textContent = parts;
            document.getElementById('modelRes').textContent = resolution;
        }
        
        // به‌روزرسانی آمار
        function updateStats() {
            document.getElementById('conversionTime').textContent = stats.conversionTime.toLocaleString();
            document.getElementById('polygonCount').textContent = stats.polygonCount.toLocaleString();
            document.getElementById('modelSize').textContent = stats.modelSize.toFixed(1) + ' MB';
            
            // محاسبه امتیاز عملکرد
            const performance = Math.min(100, Math.max(10, 
                100 - (stats.conversionTime / 1000) + 
                (stats.polygonCount / 1000) - 
                (stats.modelSize * 10)
            ));
            stats.performanceScore = Math.round(performance);
            document.getElementById('performanceScore').textContent = stats.performanceScore;
        }
        
        // فعال کردن کنترل‌ها
        function enableControls() {
            const sliders = document.querySelectorAll('.slider');
            sliders.forEach(slider => {
                slider.disabled = false;
            });
        }
        
        // ویژگی‌های پریمیوم
        function showPremiumFeatures() {
            const features = [
                '🎨 تبدیل تصاویر با وضوح ۴K',
                '🤖 هوش مصنوعی پیشرفته برای تشخیص عمق',
                '📊 خروجی در فرمت‌های مختلف (OBJ, STL, GLB)',
                '☁️ ذخیره ابری مدل‌ها',
                '👥 اشتراک‌گذاری و همکاری تیمی',
                '🛡️ پشتیبانی VIP ۲۴ ساعته'
            ];
            
            alert(`✨ نسخه پریمیوم تبدیل ۲D به ۳D:\n\n${features.join('\n')}\n\n💎 قیمت: ۲۹,۰۰۰ تومان در ماه`);
        }
        
        // نمایش مستندات API
        function showAPI() {
            alert(`📚 مستندات API تبدیل ۲D به ۳D:\n\n• REST API کامل\n• پشتیبانی از WebSocket\n• داکرایز شده\n• مستندات فارسی کامل\n\nبرای دسترسی: api@tetrashop.ir`);
        }
        
        // خروجی پروژه
        function exportProject() {
            const projectData = {
                image: currentImage,
                settings: {
                    depth: document.getElementById('depthSlider').value,
                    roughness: document.getElementById('roughnessSlider').value,
                    quality: currentQuality,
                    timestamp: new Date().toISOString()
                },
                stats: stats
            };
            
            localStorage.setItem('3dConversionProject', JSON.stringify(projectData));
            showNotification('پروژه با موفقیت ذخیره شد');
        }
        
        // نمایش نوتیفیکیشن
        function showNotification(message) {
            // حذف نوتیفیکیشن قبلی
            const oldNotification = document.querySelector('.notification');
            if (oldNotification) {
                oldNotification.remove();
            }
            
            // ایجاد نوتیفیکیشن جدید
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <i class="fas fa-info-circle"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // حذف خودکار
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideUp 0.5s ease';
                    setTimeout(() => notification.remove(), 500);
                }
            }, 3000);
        }
        
        // بارگذاری صفحه
        window.onload = function() {
            initThreeJS();
            initUpload();
            
            // بارگذاری پروژه ذخیره شده
            const savedProject = localStorage.getItem('3dConversionProject');
            if (savedProject) {
                setTimeout(() => {
                    showNotification('پروژه ذخیره شده بازیابی شد');
                }, 1000);
            }
            
            // نمایش راهنما
            setTimeout(() => {
                showNotification('برای شروع، تصویر خود را آپلود کنید');
            }, 1500);
        };
    </script>
</body>
</html>
