<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø·Ø±Ø¬Ø¯ Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ - TetraShop</title>
    <style>
        :root {
            --chess-primary: #769656;
            --chess-secondary: #b58863;
            --chess-dark: #1a1a1a;
            --chess-light: #f0f0f0;
            --chess-gold: #FFD700;
            --chess-silver: #C0C0C0;
            --chess-bronze: #CD7F32;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--chess-dark) 0%, #2c3e50 100%);
            color: var(--chess-light);
            min-height: 100vh;
        }
        
        .chess-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .chess-header {
            text-align: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 3px solid var(--chess-primary);
        }
        
        .chess-title {
            font-size: 2.8rem;
            background: linear-gradient(90deg, var(--chess-gold), var(--chess-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }
        
        .chess-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .chess-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 12px 25px;
            background: rgba(118, 150, 86, 0.2);
            color: white;
            border: 2px solid var(--chess-primary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .nav-btn:hover {
            background: var(--chess-primary);
            transform: translateY(-3px);
        }
        
        .chess-main {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 1000px) {
            .chess-main {
                grid-template-columns: 1fr;
            }
        }
        
        .chess-board-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid var(--chess-secondary);
        }
        
        .chess-board {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            border: 4px solid var(--chess-secondary);
        }
        
        .chess-square {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chess-square.light {
            background: #f0d9b5;
        }
        
        .chess-square.dark {
            background: #b58863;
        }
        
        .chess-square.selected {
            background: rgba(118, 150, 86, 0.7);
            transform: scale(1.05);
        }
        
        .chess-square.legal-move {
            background: rgba(118, 150, 86, 0.4);
        }
        
        .chess-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 12px 25px;
            background: linear-gradient(45deg, var(--chess-primary), var(--chess-secondary));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .chess-sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .chess-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid var(--chess-primary);
        }
        
        .panel-title {
            color: var(--chess-gold);
            font-size: 1.4rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--chess-primary);
        }
        
        .user-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .info-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--chess-gold);
            margin-bottom: 5px;
        }
        
        .info-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .product-card {
            background: rgba(118, 150, 86, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--chess-primary);
        }
        
        .product-card:hover {
            background: rgba(118, 150, 86, 0.4);
            transform: translateY(-5px);
        }
        
        .product-coins {
            font-size: 1.5rem;
            color: var(--chess-gold);
            margin: 10px 0;
        }
        
        .product-price {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .leaderboard {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 8px;
            border-radius: 8px;
            align-items: center;
        }
        
        .leaderboard-rank {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
        }
        
        .rank-1 { background: var(--chess-gold); color: black; }
        .rank-2 { background: var(--chess-silver); color: black; }
        .rank-3 { background: var(--chess-bronze); color: black; }
        
        .leaderboard-username {
            flex-grow: 1;
            margin: 0 15px;
        }
        
        .leaderboard-rating {
            color: var(--chess-gold);
            font-weight: bold;
        }
        
        .chess-footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.7);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="chess-container">
        <header class="chess-header">
            <h1 class="chess-title">â™Ÿï¸ Ø´Ø·Ø±Ø¬Ø¯ Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§</h1>
            <p class="chess-subtitle">Ù…Ø§Ú˜ÙˆÙ„ Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø¨Ø§Ø²ÛŒ Ø´Ø·Ø±Ø¬Ø¯ - Ø¨Ø®Ø´ÛŒ Ø§Ø² TetraShop</p>
            
            <div class="chess-nav">
                <button class="nav-btn" onclick="showSection('play')">ğŸ® Ø¨Ø§Ø²ÛŒ</button>
                <button class="nav-btn" onclick="showSection('shop')">ğŸ›’ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</button>
                <button class="nav-btn" onclick="showSection('leaderboard')">ğŸ† Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ</button>
                <button class="nav-btn" onclick="showSection('stats')">ğŸ“Š Ø¢Ù…Ø§Ø±</button>
                <button class="nav-btn" onclick="window.location.href='/dashboard'">ğŸ  Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
            </div>
            
            <div id="status-message" class="status-message" style="
                margin-top: 15px;
                padding: 10px;
                border-radius: 8px;
                display: none;
            "></div>
        </header>
        
        <main class="chess-main">
            <!-- Ø¨Ø®Ø´ Ø¨Ø§Ø²ÛŒ -->
            <div class="chess-board-section" id="play-section">
                <h2 class="panel-title">ğŸ® ØµÙØ­Ù‡ Ø´Ø·Ø±Ø¬Ø¯</h2>
                <div class="chess-board" id="chess-board">
                    <!-- ØªØ®ØªÙ‡ Ø´Ø·Ø±Ø¬Ø¯ Ø¨Ø§ JavaScript Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
                
                <div class="chess-controls">
                    <button class="control-btn" onclick="startNewGame('beginner', 'free')">
                        ğŸ†“ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù†
                    </button>
                    <button class="control-btn" onclick="startNewGame('advanced', 'premium')">
                        ğŸ’ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
                    </button>
                    <button class="control-btn" onclick="undoMove()">
                        â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø­Ø±Ú©Øª
                    </button>
                    <button class="control-btn" onclick="resignGame()">
                        ğŸ³ï¸ ØªØ³Ù„ÛŒÙ…
                    </button>
                    <button class="control-btn" onclick="requestHint()">
                        ğŸ’¡ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ (Ûµ Ø³Ú©Ù‡)
                    </button>
                </div>
                
                <div style="margin-top: 25px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--chess-gold); font-weight: bold;">ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ</div>
                        <div id="game-status">Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                        <div style="color: var(--chess-gold); font-weight: bold;">Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</div>
                        <div id="position-eval">+0.0</div>
                    </div>
                </div>
            </div>
            
            <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± Ø§Ø·Ù„Ø§Ø¹Ø§Øª -->
            <div class="chess-sidebar">
                <!-- Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø± -->
                <div class="chess-panel">
                    <h2 class="panel-title">ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±ÛŒ</h2>
                    
                    <div id="login-section" style="display: block;">
                        <div style="margin-bottom: 20px;">
                            <input type="text" id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" style="
                                width: 100%;
                                padding: 12px;
                                margin-bottom: 10px;
                                background: rgba(255,255,255,0.1);
                                border: 1px solid var(--chess-primary);
                                border-radius: 8px;
                                color: white;
                            ">
                            <input type="password" id="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" style="
                                width: 100%;
                                padding: 12px;
                                margin-bottom: 15px;
                                background: rgba(255,255,255,0.1);
                                border: 1px solid var(--chess-primary);
                                border-radius: 8px;
                                color: white;
                            ">
                            <div style="display: flex; gap: 10px;">
                                <button class="control-btn" onclick="login()" style="flex: 1;">
                                    ğŸ”‘ ÙˆØ±ÙˆØ¯
                                </button>
                                <button class="control-btn" onclick="register()" style="flex: 1;">
                                    ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="user-info-section" style="display: none;">
                        <div class="user-info">
                            <div class="info-item">
                                <div class="info-value" id="user-coins">Û°</div>
                                <div class="info-label">Ø³Ú©Ù‡</div>
                            </div>
                            <div class="info-item">
                                <div class="info-value" id="user-rating">Û±Û²Û°Û°</div>
                                <div class="info-label">Ø§Ù…ØªÛŒØ§Ø²</div>
                            </div>
                            <div class="info-item">
                                <div class="info-value" id="user-level">Ù…Ø¨ØªØ¯ÛŒ</div>
                                <div class="info-label">Ø³Ø·Ø­</div>
                            </div>
                            <div class="info-item">
                                <div class="info-value" id="user-wins">Û°</div>
                                <div class="info-label">Ø¨Ø±Ø¯</div>
                            </div>
                        </div>
                        
                        <button class="control-btn" onclick="logout()" style="width: 100%; margin-top: 15px;">
                            ğŸšª Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </div>
                
                <!-- Ù¾Ù†Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ -->
                <div class="chess-panel" id="shop-section" style="display: none;">
                    <h2 class="panel-title">ğŸ›’ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø³Ú©Ù‡</h2>
                    
                    <div class="product-grid">
                        <div class="product-card" onclick="buyCoins('coin_100')">
                            <div>ğŸ’</div>
                            <div class="product-coins">Û±Û°Û° Ø³Ú©Ù‡</div>
                            <div class="product-price">Û±Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                            <small>Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡</small>
                        </div>
                        
                        <div class="product-card" onclick="buyCoins('coin_500')">
                            <div>ğŸ’ğŸ’</div>
                            <div class="product-coins">ÛµÛ°Û° Ø³Ú©Ù‡</div>
                            <div class="product-price">Û´Ûµ,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                            <small>ØªØ®ÙÛŒÙ Û±Û°Ùª</small>
                        </div>
                        
                        <div class="product-card" onclick="buyCoins('coin_1000')">
                            <div>ğŸ’ğŸ’ğŸ’</div>
                            <div class="product-coins">Û±Û°Û°Û° Ø³Ú©Ù‡</div>
                            <div class="product-price">Û¸Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                            <small>ØªØ®ÙÛŒÙ Û²Û°Ùª</small>
                        </div>
                        
                        <div class="product-card" onclick="buySubscription('premium')">
                            <div>ğŸ‘‘</div>
                            <div class="product-coins">Ø§Ø´ØªØ±Ø§Ú© Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…</div>
                            <div class="product-price">Û³Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                            <small>Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯</small>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <small style="opacity: 0.7;">ğŸ’¡ Ø¨Ø§ Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡ Ø¨Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯</small>
                    </div>
                </div>
                
                <!-- Ù¾Ù†Ù„ Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ -->
                <div class="chess-panel" id="leaderboard-section" style="display: none;">
                    <h2 class="panel-title">ğŸ† Ø¬Ø¯ÙˆÙ„ Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ</h2>
                    
                    <div class="leaderboard" id="leaderboard-list">
                        <!-- Ø¨Ø§ JavaScript Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                    </div>
                    
                    <div style="margin-top: 15px; text-align: center;">
                        <button class="control-btn" onclick="refreshLeaderboard()">
                            ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
                        </button>
                    </div>
                </div>
                
                <!-- Ù¾Ù†Ù„ Ø¢Ù…Ø§Ø± -->
                <div class="chess-panel" id="stats-section" style="display: none;">
                    <h2 class="panel-title">ğŸ“Š Ø¢Ù…Ø§Ø± Ø³ÛŒØ³ØªÙ…</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0;">
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 1.8rem; color: var(--chess-gold);" id="stats-users">Û°</div>
                            <div style="font-size: 0.9rem;">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ú©Ù„</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 1.8rem; color: #4CAF50;" id="stats-revenue">Û°</div>
                            <div style="font-size: 0.9rem;">Ø¯Ø±Ø¢Ù…Ø¯ Ø§Ù…Ø±ÙˆØ²</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 1.8rem; color: var(--chess-primary);" id="stats-games">Û°</div>
                            <div style="font-size: 0.9rem;">Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</div>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 1.8rem; color: var(--chess-silver);" id="stats-transactions">Û°</div>
                            <div style="font-size: 0.9rem;">ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <div style="font-weight: bold; color: var(--chess-gold); margin-bottom: 10px;">
                            ğŸ“ˆ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡:
                        </div>
                        <div style="background: rgba(76, 175, 80, 0.2); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 1.8rem; color: #4CAF50;">Û¹,ÛµÛ°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ: Û¶,Û¶ÛµÛ°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="chess-footer">
            <p>Â© Û²Û°Û²Û´ Ù…Ø§Ú˜ÙˆÙ„ Ø´Ø·Ø±Ø¬Ø¯ Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ - Ø¨Ø®Ø´ÛŒ Ø§Ø² Ù¾Ù„ØªÙØ±Ù… TetraShop</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÙÙ†ÛŒ: Û°Û¹Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹ | 
                ğŸ’° Ù…Ø¯Ù„ Ø¯Ø±Ø¢Ù…Ø¯ÛŒ: Freemium |
                ğŸš€ Ù†Ø³Ø®Ù‡: Û².Û°.Û°
            </p>
        </footer>
    </div>
    
    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…
        let currentUser = null;
        let currentGame = null;
        let chessBoard = [];
        let selectedSquare = null;
        let legalMoves = [];
        
        // ØªØ®ØªÙ‡ Ø´Ø·Ø±Ø¬Ø¯ Ø§ÙˆÙ„ÛŒÙ‡
        const initialBoard = [
            ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
            ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
            ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
        ];
        
        // Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ Ø´Ø·Ø±Ø¬Ø¯
        const pieceSymbols = {
            'r': 'â™œ', 'n': 'â™', 'b': 'â™', 'q': 'â™›', 'k': 'â™š', 'p': 'â™Ÿ',
            'R': 'â™–', 'N': 'â™˜', 'B': 'â™—', 'Q': 'â™•', 'K': 'â™”', 'P': 'â™™'
        };
        
        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', () => {
            initializeChessBoard();
            loadSystemStats();
            showSection('play');
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡
            const savedUser = localStorage.getItem('chess_user');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showUserInfo();
                    showMessage('Ú©Ø§Ø±Ø¨Ø± Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ' + currentUser.username, 'success');
                } catch (e) {
                    localStorage.removeItem('chess_user');
                }
            }
        });
        
        // Ø§ÛŒØ¬Ø§Ø¯ ØªØ®ØªÙ‡ Ø´Ø·Ø±Ø¬Ø¯
        function initializeChessBoard() {
            const boardElement = document.getElementById('chess-board');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `chess-square ${(row + col) % 2 === 0 ? 'dark' : 'light'}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    
                    const piece = initialBoard[row][col];
                    if (piece) {
                        square.textContent = pieceSymbols[piece];
                        square.style.color = piece === piece.toLowerCase() ? '#000' : '#fff';
                    }
                    
                    square.onclick = () => handleSquareClick(row, col);
                    boardElement.appendChild(square);
                }
            }
            
            chessBoard = JSON.parse(JSON.stringify(initialBoard));
        }
        
        // Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø®Ø§Ù†Ù‡ Ø´Ø·Ø±Ø¬Ø¯
        function handleSquareClick(row, col) {
            if (!currentUser) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯', 'error');
                return;
            }
            
            const square = document.querySelector(`.chess-square[data-row="${row}"][data-col="${col}"]`);
            const piece = chessBoard[row][col];
            
            // Ø§Ú¯Ø± Ø®Ø§Ù†Ù‡â€ŒØ§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯
            if (selectedSquare) {
                const [selectedRow, selectedCol] = selectedSquare;
                const isLegalMove = legalMoves.some(move => 
                    move.to.row === row && move.to.col === col
                );
                
                if (isLegalMove) {
                    // Ø§Ù†Ø¬Ø§Ù… Ø­Ø±Ú©Øª
                    movePiece(selectedRow, selectedCol, row, col);
                    selectedSquare = null;
                    legalMoves = [];
                    clearHighlights();
                    
                    // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­Ø±Ú©Øª Ù…ÙˆØªÙˆØ±
                    setTimeout(() => {
                        requestEngineMove();
                    }, 500);
                } else {
                    // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù‡Ø±Ù‡ Ø¬Ø¯ÛŒØ¯
                    selectedSquare = [row, col];
                    legalMoves = getLegalMoves(row, col);
                    highlightMoves(legalMoves);
                }
            } else if (piece) {
                // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù‡Ø±Ù‡
                selectedSquare = [row, col];
                legalMoves = getLegalMoves(row, col);
                highlightMoves(legalMoves);
            }
        }
        
        // Ø­Ø±Ú©Øª Ù…Ù‡Ø±Ù‡
        function movePiece(fromRow, fromCol, toRow, toCol) {
            const piece = chessBoard[fromRow][fromCol];
            chessBoard[fromRow][fromCol] = '';
            chessBoard[toRow][toCol] = piece;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´
            updateBoardDisplay();
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØ®ØªÙ‡
        function updateBoardDisplay() {
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.querySelector(`.chess-square[data-row="${row}"][data-col="${col}"]`);
                    const piece = chessBoard[row][col];
                    
                    if (square) {
                        square.textContent = piece ? pieceSymbols[piece] : '';
                        square.style.color = piece && piece === piece.toLowerCase() ? '#000' : '#fff';
                    }
                }
            }
        }
        
        // Ø­Ø±Ú©Ø§Øª Ù…Ø¬Ø§Ø² (Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡)
        function getLegalMoves(row, col) {
            const piece = chessBoard[row][col];
            const moves = [];
            
            if (!piece) return moves;
            
            // ÙÙ‚Ø· Ù¾ÛŒØ§Ø¯Ù‡â€ŒÙ‡Ø§ Ø­Ø±Ú©Øª Ø±Ùˆ Ø¨Ù‡ Ø¬Ù„Ùˆ
            if (piece === 'P') { // Ù¾ÛŒØ§Ø¯Ù‡ Ø³ÙÛŒØ¯
                if (row > 0 && !chessBoard[row-1][col]) {
                    moves.push({ from: {row, col}, to: {row: row-1, col} });
                }
            } else if (piece === 'p') { // Ù¾ÛŒØ§Ø¯Ù‡ Ø³ÛŒØ§Ù‡
                if (row < 7 && !chessBoard[row+1][col]) {
                    moves.push({ from: {row, col}, to: {row: row+1, col} });
                }
            }
            
            return moves;
        }
        
        // Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø­Ø±Ú©Ø§Øª Ù…Ø¬Ø§Ø²
        function highlightMoves(moves) {
            clearHighlights();
            
            // Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø®Ø§Ù†Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            if (selectedSquare) {
                const [row, col] = selectedSquare;
                const selectedSquareEl = document.querySelector(`.chess-square[data-row="${row}"][data-col="${col}"]`);
                if (selectedSquareEl) {
                    selectedSquareEl.classList.add('selected');
                }
            }
            
            // Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø­Ø±Ú©Ø§Øª Ù…Ø¬Ø§Ø²
            moves.forEach(move => {
                const square = document.querySelector(`.chess-square[data-row="${move.to.row}"][data-col="${move.to.col}"]`);
                if (square) {
                    square.classList.add('legal-move');
                }
            });
        }
        
        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ø§ÛŒÙ„Ø§ÛŒØªâ€ŒÙ‡Ø§
        function clearHighlights() {
            document.querySelectorAll('.chess-square').forEach(square => {
                square.classList.remove('selected', 'legal-move');
            });
        }
        
        // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯
        async function startNewGame(difficulty, gameType) {
            if (!currentUser) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯', 'error');
                return;
            }
            
            try {
                const response = await fetch('/chess/api/game/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: currentUser.username,
                        difficulty,
                        gameType
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentGame = result.gameId;
                    initializeChessBoard();
                    showMessage(result.message, 'success');
                    document.getElementById('game-status').textContent = 'Ø¨Ø§Ø²ÛŒ ÙØ¹Ø§Ù„ - Ù†ÙˆØ¨Øª Ø´Ù…Ø§';
                    
                    if (gameType === 'premium') {
                        updateUserCoins(currentUser.coins - 10);
                    }
                } else {
                    showMessage(result.error, 'error');
                }
            } catch (error) {
                showMessage('Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±', 'error');
            }
        }
        
        // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø­Ø±Ú©Øª Ù…ÙˆØªÙˆØ±
        async function requestEngineMove() {
            if (!currentGame) return;
            
            try {
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø­Ø±Ú©Øª Ù…ÙˆØªÙˆØ±
                setTimeout(() => {
                    // Ø­Ø±Ú©Øª Ø³Ø§Ø¯Ù‡ Ù…ÙˆØªÙˆØ±
                    const possibleMoves = [];
                    for (let row = 0; row < 8; row++) {
                        for (let col = 0; col < 8; col++) {
                            if (chessBoard[row][col] && chessBoard[row][col] === chessBoard[row][col].toLowerCase()) {
                                const moves = getLegalMoves(row, col);
                                possibleMoves.push(...moves);
                            }
                        }
                    }
                    
                    if (possibleMoves.length > 0) {
                        const randomMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                        movePiece(randomMove.from.row, randomMove.from.col, randomMove.to.row, randomMove.to.col);
                        document.getElementById('game-status').textContent = 'Ø¨Ø§Ø²ÛŒ ÙØ¹Ø§Ù„ - Ù†ÙˆØ¨Øª Ø´Ù…Ø§';
                        
                        // Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ ØªØµØ§Ø¯ÙÛŒ
                        const evalValue = (Math.random() * 2 - 1).toFixed(2);
                        document.getElementById('position-eval').textContent = 
                            evalValue > 0 ? `+${evalValue}` : evalValue;
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø­Ø±Ú©Øª Ù…ÙˆØªÙˆØ±:', error);
            }
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
        function showSection(section) {
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§
            ['play-section', 'shop-section', 'leaderboard-section', 'stats-section'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            const targetSection = document.getElementById(section + '-section');
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            // Ø§Ú¯Ø± Ø¨Ø®Ø´ Ø¢Ù…Ø§Ø± Ø§Ø³ØªØŒ Ø¢Ù…Ø§Ø± Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ² Ú©Ù†
            if (section === 'stats') {
                loadSystemStats();
            }
            
            // Ø§Ú¯Ø± Ø¨Ø®Ø´ Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ø³ØªØŒ Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ú©Ù†
            if (section === 'leaderboard') {
                loadLeaderboard();
            }
        }
        
        // ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            try {
                const response = await fetch('/chess/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentUser = result.user;
                    localStorage.setItem('chess_user', JSON.stringify(currentUser));
                    showUserInfo();
                    showMessage('ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ' + username, 'success');
                } else {
                    showMessage(result.error, 'error');
                }
            } catch (error) {
                showMessage('Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±', 'error');
            }
        }
        
        // Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±
        async function register() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            if (username.length < 3) {
                showMessage('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û³ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯', 'error');
                return;
            }
            
            if (password.length < 6) {
                showMessage('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯', 'error');
                return;
            }
            
            try {
                const response = await fetch('/chess/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        username, 
                        password,
                        email: username + '@chess.tetrashop'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯! Ø­Ø§Ù„Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯', 'success');
                } else {
                    showMessage(result.error, 'error');
                }
            } catch (error) {
                showMessage('Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±', 'error');
            }
        }
        
        // Ø®Ø±ÙˆØ¬ Ú©Ø§Ø±Ø¨Ø±
        function logout() {
            currentUser = null;
            localStorage.removeItem('chess_user');
            
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('user-info-section').style.display = 'none';
            
            showMessage('Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯', 'success');
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
        function showUserInfo() {
            if (!currentUser) return;
            
            document.getElementById('user-coins').textContent = currentUser.coins || 0;
            document.getElementById('user-rating').textContent = currentUser.rating || 1200;
            document.getElementById('user-level').textContent = 
                (currentUser.rating >= 2000 ? 'Ø§Ø³ØªØ§Ø¯' : 
                 currentUser.rating >= 1600 ? 'Ù¾ÛŒØ´Ø±ÙØªÙ‡' : 
                 currentUser.rating >= 1400 ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ø¨ØªØ¯ÛŒ');
            document.getElementById('user-wins').textContent = currentUser.wins || 0;
            
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('user-info-section').style.display = 'block';
        }
        
        // Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡
        async function buyCoins(productId) {
            if (!currentUser) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯', 'error');
                return;
            }
            
            const confirmBuy = confirm('Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÛŒØ¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ');
            if (!confirmBuy) return;
            
            try {
                const response = await fetch('/chess/api/payment/buy-coins', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: currentUser.username,
                        productId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
                    currentUser.coins = result.newBalance;
                    localStorage.setItem('chess_user', JSON.stringify(currentUser));
                    
                    showUserInfo();
                    showMessage(result.message, 'success');
                } else {
                    showMessage(result.error, 'error');
                }
            } catch (error) {
                showMessage('Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±', 'error');
            }
        }
        
        // Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú©
        async function buySubscription(plan) {
            if (!currentUser) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯', 'error');
                return;
            }
            
            const confirmBuy = confirm('Ø¢ÛŒØ§ Ø§Ø² Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ… Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ\n\nÙ…Ø¨Ù„Øº: Û³Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†');
            if (!confirmBuy) return;
            
            showMessage('Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª...', 'info');
        }
        
        // Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ
        async function loadLeaderboard() {
            try {
                const response = await fetch('/chess/api/leaderboard?limit=10');
                const result = await response.json();
                
                if (result.success) {
                    const leaderboardList = document.getElementById('leaderboard-list');
                    leaderboardList.innerHTML = '';
                    
                    result.leaderboard.forEach((user, index) => {
                        const item = document.createElement('div');
                        item.className = 'leaderboard-item';
                        
                        item.innerHTML = `
                            <div class="leaderboard-rank ${index < 3 ? `rank-${index + 1}` : ''}">
                                ${index + 1}
                            </div>
                            <div class="leaderboard-username">${user.username}</div>
                            <div class="leaderboard-rating">${user.rating}</div>
                        `;
                        
                        leaderboardList.appendChild(item);
                    });
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ:', error);
            }
        }
        
        // Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø¢Ù…Ø§Ø± Ø³ÛŒØ³ØªÙ…
        async function loadSystemStats() {
            try {
                const response = await fetch('/chess/api/stats');
                const stats = await response.json();
                
                if (!stats.error) {
                    document.getElementById('stats-users').textContent = stats.users?.total || 0;
                    document.getElementById('stats-revenue').textContent = 
                        (stats.revenue?.today || 0).toLocaleString('fa-IR') + ' ØªÙˆÙ…Ø§Ù†';
                    document.getElementById('stats-games').textContent = stats.games?.total || 0;
                    document.getElementById('stats-transactions').textContent = 
                        (stats.revenue?.total / 10000).toFixed(0) || 0;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø¢Ù…Ø§Ø±:', error);
            }
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø³Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø±
        function updateUserCoins(newCoins) {
            if (!currentUser) return;
            
            currentUser.coins = newCoins;
            localStorage.setItem('chess_user', JSON.stringify(currentUser));
            showUserInfo();
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        function showMessage(message, type = 'info') {
            const messageEl = document.getElementById('status-message');
            messageEl.textContent = message;
            messageEl.style.display = 'block';
            
            switch (type) {
                case 'success':
                    messageEl.style.background = 'rgba(76, 175, 80, 0.2)';
                    messageEl.style.border = '1px solid #4CAF50';
                    messageEl.style.color = '#4CAF50';
                    break;
                case 'error':
                    messageEl.style.background = 'rgba(244, 67, 54, 0.2)';
                    messageEl.style.border = '1px solid #F44336';
                    messageEl.style.color = '#F44336';
                    break;
                default:
                    messageEl.style.background = 'rgba(33, 150, 243, 0.2)';
                    messageEl.style.border = '1px solid #2196F3';
                    messageEl.style.color = '#2196F3';
            }
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ø¨Ø§Ø²ÛŒ
        function undoMove() {
            showMessage('Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ø§Ø²Ú¯Ø´Øª Ø­Ø±Ú©Øª Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª', 'info');
        }
        
        function resignGame() {
            if (currentGame) {
                if (confirm('Ø¢ÛŒØ§ Ø§Ø² ØªØ³Ù„ÛŒÙ… Ø´Ø¯Ù† Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                    showMessage('Ø¨Ø§Ø²ÛŒ Ø¨Ø§ ØªØ³Ù„ÛŒÙ… Ø´Ù…Ø§ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯', 'info');
                    currentGame = null;
                    document.getElementById('game-status').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹';
                }
            } else {
                showMessage('Ù‡ÛŒÚ† Ø¨Ø§Ø²ÛŒ ÙØ¹Ø§Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'error');
            }
        }
        
        function requestHint() {
            if (!currentUser || currentUser.coins < 5) {
                showMessage('Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø­Ø¯Ø§Ù‚Ù„ Ûµ Ø³Ú©Ù‡ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯', 'error');
                return;
            }
            
            if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ûµ Ø³Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†ÛŒØ¯ØŸ')) {
                updateUserCoins(currentUser.coins - 5);
                showMessage('ğŸ’¡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Ø­Ø±Ú©Øª Ù¾ÛŒØ§Ø¯Ù‡ e2 Ø¨Ù‡ e4', 'success');
            }
        }
        
        function refreshLeaderboard() {
            loadLeaderboard();
            showMessage('Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´Ø¯', 'success');
        }
    </script>
</body>
</html>
