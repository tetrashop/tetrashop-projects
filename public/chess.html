<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â™Ÿï¸ Ø´Ø·Ø±Ø¬Ø¯ Ú©ÙˆØ§Ù†ØªØ§ - TetraShop Quantum</title>
    <style>
        :root {
            --chess-dark: #1a1a2e;
            --chess-light: #f0f0f0;
            --chess-board-dark: #769656;
            --chess-board-light: #eeeed2;
            --chess-gold: #FFD700;
            --chess-silver: #C0C0C0;
            --chess-bronze: #CD7F32;
            --chess-primary: #0ea5e9;
            --chess-success: #10b981;
            --chess-warning: #f59e0b;
            --chess-danger: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
        }
        
        .chess-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .chess-header {
            text-align: center;
            padding: 30px;
            background: rgba(15, 23, 42, 0.8);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px solid rgba(14, 165, 233, 0.3);
        }
        
        .chess-title {
            font-size: 3rem;
            background: linear-gradient(90deg, #0ea5e9, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }
        
        .chess-subtitle {
            color: #94a3b8;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .chess-main {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1100px) {
            .chess-main {
                grid-template-columns: 1fr;
            }
        }
        
        .board-section {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(139, 92, 246, 0.3);
        }
        
        .chess-board {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            border: 4px solid #475569;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }
        
        .chess-square {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.8rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .chess-square.light {
            background-color: var(--chess-board-light);
        }
        
        .chess-square.dark {
            background-color: var(--chess-board-dark);
        }
        
        .chess-square.selected {
            background-color: rgba(14, 165, 233, 0.7) !important;
            transform: scale(1.05);
        }
        
        .chess-square.legal-move::after {
            content: '';
            position: absolute;
            width: 30%;
            height: 30%;
            background: rgba(14, 165, 233, 0.6);
            border-radius: 50%;
        }
        
        .chess-square.legal-capture {
            background: rgba(239, 68, 68, 0.3) !important;
        }
        
        .chess-square.legal-capture::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid rgba(239, 68, 68, 0.8);
            border-radius: 50%;
        }
        
        .chess-controls {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .control-btn {
            padding: 15px 25px;
            background: linear-gradient(90deg, #0ea5e9, #3b82f6);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(14, 165, 233, 0.4);
        }
        
        .control-btn.premium {
            background: linear-gradient(90deg, #f59e0b, #f97316);
        }
        
        .control-btn.success {
            background: linear-gradient(90deg, #10b981, #059669);
        }
        
        .control-btn.danger {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }
        
        .chess-sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .sidebar-panel {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(148, 163, 184, 0.1);
        }
        
        .panel-title {
            color: #0ea5e9;
            font-size: 1.4rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(14, 165, 233, 0.3);
        }
        
        .user-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-card {
            background: rgba(30, 41, 59, 0.5);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .info-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #f59e0b;
            margin-bottom: 5px;
        }
        
        .info-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .shop-item {
            background: rgba(30, 41, 59, 0.5);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid rgba(14, 165, 233, 0.2);
        }
        
        .shop-item:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: #0ea5e9;
            transform: translateY(-5px);
        }
        
        .shop-item.premium {
            border-color: rgba(245, 158, 11, 0.3);
            background: rgba(245, 158, 11, 0.1);
        }
        
        .shop-coins {
            font-size: 1.5rem;
            color: #f59e0b;
            margin: 10px 0;
        }
        
        .shop-price {
            color: #10b981;
            font-weight: bold;
        }
        
        .move-list {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            padding: 15px;
        }
        
        .move-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }
        
        .move-number {
            color: #94a3b8;
        }
        
        .move-white, .move-black {
            font-family: monospace;
            font-weight: bold;
        }
        
        .move-white {
            color: white;
        }
        
        .move-black {
            color: #f59e0b;
        }
        
        .chess-footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid rgba(148, 163, 184, 0.2);
            color: #94a3b8;
        }
        
        .game-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .info-box {
            background: rgba(30, 41, 59, 0.5);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        .piece.white {
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .piece.black {
            color: #1a1a2e;
            text-shadow: 0 2px 4px rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <div class="chess-container">
        <!-- Ù‡Ø¯Ø± -->
        <header class="chess-header">
            <h1 class="chess-title">â™Ÿï¸ Ø´Ø·Ø±Ø¬Ø¯ Ú©ÙˆØ§Ù†ØªØ§</h1>
            <p class="chess-subtitle">Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø´Ø·Ø±Ø¬Ø¯ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø±Ø¢Ù…Ø¯Ø²Ø§ÛŒÛŒ Ø¨Ø§Ù„Ø§ - Ø¨Ø®Ø´ÛŒ Ø§Ø² TetraShop Quantum</p>
            
            <div style="display: flex; justify-content: center; gap: 15px; margin-top: 20px;">
                <button class="control-btn" onclick="window.location.href='/'">
                    ğŸ  Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                </button>
                <button class="control-btn success" onclick="showRevenueStats()">
                    ğŸ’° Ø¢Ù…Ø§Ø± Ø¯Ø±Ø¢Ù…Ø¯
                </button>
                <button class="control-btn" onclick="showHelp()">
                    â“ Ø±Ø§Ù‡Ù†Ù…Ø§
                </button>
            </div>
        </header>
        
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
        <div class="chess-main">
            <!-- Ø¨Ø®Ø´ ØªØ®ØªÙ‡ Ø´Ø·Ø±Ø¬Ø¯ -->
            <div class="board-section">
                <h2 class="panel-title">ğŸ® ØªØ®ØªÙ‡ Ø´Ø·Ø±Ø¬Ø¯</h2>
                
                <div id="chess-board" class="chess-board">
                    <!-- ØªØ®ØªÙ‡ Ø¨Ø§ JavaScript Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
                
                <div class="game-info">
                    <div class="info-box">
                        <div style="color: #94a3b8;">ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ</div>
                        <div id="game-status" style="font-size: 1.2rem; color: #0ea5e9; margin-top: 5px;">
                            Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹
                        </div>
                    </div>
                    <div class="info-box">
                        <div style="color: #94a3b8;">Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</div>
                        <div id="position-eval" style="font-size: 1.2rem; color: #10b981; margin-top: 5px;">
                            +0.00
                        </div>
                    </div>
                </div>
                
                <div class="chess-controls">
                    <button class="control-btn" onclick="startGame('beginner', 'free')">
                        ğŸ†“ Ø¨Ø§Ø²ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù†
                    </button>
                    <button class="control-btn premium" onclick="startGame('expert', 'premium')">
                        ğŸ’ Ø¨Ø§Ø²ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
                    </button>
                    <button class="control-btn" onclick="undoMove()">
                        â†©ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø­Ø±Ú©Øª
                    </button>
                    <button class="control-btn danger" onclick="resignGame()">
                        ğŸ³ï¸ ØªØ³Ù„ÛŒÙ…
                    </button>
                    <button class="control-btn success" onclick="analyzePosition()">
                        ğŸ” ØªØ­Ù„ÛŒÙ„ Ù…ÙˆÙ‚Ø¹ÛŒØª
                    </button>
                </div>
                
                <div id="move-list" class="move-list" style="margin-top: 20px;">
                    <div style="text-align: center; color: #94a3b8; padding: 10px;">
                        Ù„ÛŒØ³Øª Ø­Ø±Ú©Ø§Øª
                    </div>
                    <div id="moves-container"></div>
                </div>
            </div>
            
            <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± -->
            <div class="chess-sidebar">
                <!-- Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø± -->
                <div class="sidebar-panel">
                    <h2 class="panel-title">ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±ÛŒ</h2>
                    
                    <div id="login-section">
                        <input type="text" id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" style="
                            width: 100%;
                            padding: 12px;
                            margin-bottom: 10px;
                            background: rgba(30, 41, 59, 0.8);
                            border: 2px solid #475569;
                            border-radius: 8px;
                            color: white;
                        ">
                        <input type="password" id="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" style="
                            width: 100%;
                            padding: 12px;
                            margin-bottom: 15px;
                            background: rgba(30, 41, 59, 0.8);
                            border: 2px solid #475569;
                            border-radius: 8px;
                            color: white;
                        ">
                        <div style="display: flex; gap: 10px;">
                            <button class="control-btn" onclick="login()" style="flex: 1;">
                                ğŸ”‘ ÙˆØ±ÙˆØ¯
                            </button>
                            <button class="control-btn" onclick="register()" style="flex: 1;">
                                ğŸ“ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                            </button>
                        </div>
                    </div>
                    
                    <div id="user-section" style="display: none;">
                        <div class="user-info-grid">
                            <div class="info-card">
                                <div class="info-value" id="user-coins">100</div>
                                <div class="info-label">Ø³Ú©Ù‡</div>
                            </div>
                            <div class="info-card">
                                <div class="info-value" id="user-rating">1200</div>
                                <div class="info-label">Ø§Ù…ØªÛŒØ§Ø²</div>
                            </div>
                            <div class="info-card">
                                <div class="info-value" id="user-level">Ù…Ø¨ØªØ¯ÛŒ</div>
                                <div class="info-label">Ø³Ø·Ø­</div>
                            </div>
                            <div class="info-card">
                                <div class="info-value" id="user-games">0</div>
                                <div class="info-label">Ø¨Ø§Ø²ÛŒ</div>
                            </div>
                        </div>
                        
                        <button class="control-btn danger" onclick="logout()" style="width: 100%;">
                            ğŸšª Ø®Ø±ÙˆØ¬
                        </button>
                    </div>
                </div>
                
                <!-- ÙØ±ÙˆØ´Ú¯Ø§Ù‡ -->
                <div class="sidebar-panel">
                    <h2 class="panel-title">ğŸ›’ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø³Ú©Ù‡</h2>
                    
                    <div class="shop-grid">
                        <div class="shop-item" onclick="buyCoins(100, 10000)">
                            <div>ğŸ’</div>
                            <div class="shop-coins">Û±Û°Û° Ø³Ú©Ù‡</div>
                            <div class="shop-price">Û±Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                        </div>
                        
                        <div class="shop-item" onclick="buyCoins(500, 45000)">
                            <div>ğŸ’ğŸ’</div>
                            <div class="shop-coins">ÛµÛ°Û° Ø³Ú©Ù‡</div>
                            <div class="shop-price">Û´Ûµ,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                        </div>
                        
                        <div class="shop-item premium" onclick="buyCoins(1000, 80000)">
                            <div>ğŸ’ğŸ’ğŸ’</div>
                            <div class="shop-coins">Û±Û°Û°Û° Ø³Ú©Ù‡</div>
                            <div class="shop-price">Û¸Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                        </div>
                        
                        <div class="shop-item premium" onclick="buySubscription()">
                            <div>ğŸ‘‘</div>
                            <div class="shop-coins">Ø§Ø´ØªØ±Ø§Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
                            <div class="shop-price">Û³Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; text-align: center; color: #94a3b8; font-size: 0.9rem;">
                        ğŸ’¡ Ø¨Ø§ Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡ Ø¨Ù‡ ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯
                    </div>
                </div>
                
                <!-- Ø¢Ù…Ø§Ø± Ø³ÛŒØ³ØªÙ… -->
                <div class="sidebar-panel">
                    <h2 class="panel-title">ğŸ“Š Ø¢Ù…Ø§Ø± Ø´Ø·Ø±Ø¬Ø¯</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0;">
                        <div class="info-card">
                            <div class="info-value" id="stats-users">2</div>
                            <div class="info-label">Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</div>
                        </div>
                        <div class="info-card">
                            <div class="info-value" id="stats-games">1</div>
                            <div class="info-label">Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§</div>
                        </div>
                        <div class="info-card">
                            <div class="info-value" id="stats-revenue">55K</div>
                            <div class="info-label">Ø¯Ø±Ø¢Ù…Ø¯</div>
                        </div>
                        <div class="info-card">
                            <div class="info-value" id="stats-online">1</div>
                            <div class="info-label">Ø¢Ù†Ù„Ø§ÛŒÙ†</div>
                        </div>
                    </div>
                    
                    <button class="control-btn" onclick="loadStats()" style="width: 100%;">
                        ğŸ”„ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ÙÙˆØªØ± -->
        <footer class="chess-footer">
            <p>Â© Û²Û°Û²Û´ Ø´Ø·Ø±Ø¬Ø¯ Ú©ÙˆØ§Ù†ØªØ§ - Ø¨Ø®Ø´ÛŒ Ø§Ø² Ù¾Ù„ØªÙØ±Ù… TetraShop Quantum</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">
                ğŸš€ Ù†Ø³Ø®Ù‡ Û².Ûµ.Û° | ğŸ’° Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡: Û¹,ÛµÛ°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†
            </p>
        </footer>
    </div>
    
    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…
        let chessBoard = [];
        let currentUser = null;
        let currentGame = null;
        let selectedSquare = null;
        let movesHistory = [];
        let playerColor = 'white';
        
        // ØªØ®ØªÙ‡ Ø§ÙˆÙ„ÛŒÙ‡
        const initialBoard = [
            ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
            ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
            ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
        ];
        
        // Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ Ø´Ø·Ø±Ø¬Ø¯
        const pieceSymbols = {
            'r': 'â™œ', 'n': 'â™', 'b': 'â™', 'q': 'â™›', 'k': 'â™š', 'p': 'â™Ÿ',
            'R': 'â™–', 'N': 'â™˜', 'B': 'â™—', 'Q': 'â™•', 'K': 'â™”', 'P': 'â™™'
        };
        
        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', () => {
            initializeBoard();
            loadStats();
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
            const savedUser = localStorage.getItem('chess_user');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showUserSection();
                } catch (e) {
                    localStorage.removeItem('chess_user');
                }
            }
            
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯
            setTimeout(() => {
                showMessage('â™Ÿï¸ Ø¨Ù‡ Ø´Ø·Ø±Ø¬Ø¯ Ú©ÙˆØ§Ù†ØªØ§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯! Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.', 'info');
            }, 1000);
        });
        
        // Ø§ÛŒØ¬Ø§Ø¯ ØªØ®ØªÙ‡ Ø´Ø·Ø±Ø¬Ø¯
        function initializeBoard() {
            const boardElement = document.getElementById('chess-board');
            boardElement.innerHTML = '';
            
            chessBoard = JSON.parse(JSON.stringify(initialBoard));
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `chess-square ${(row + col) % 2 === 0 ? 'dark' : 'light'}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    
                    const piece = chessBoard[row][col];
                    if (piece) {
                        const pieceDiv = document.createElement('div');
                        pieceDiv.className = `piece ${piece === piece.toLowerCase() ? 'black' : 'white'}`;
                        pieceDiv.textContent = pieceSymbols[piece];
                        pieceDiv.style.cursor = 'pointer';
                        square.appendChild(pieceDiv);
                    }
                    
                    square.onclick = () => handleSquareClick(row, col);
                    boardElement.appendChild(square);
                }
            }
            
            updateMoveList();
        }
        
        // Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø®Ø§Ù†Ù‡
        function handleSquareClick(row, col) {
            if (!currentUser && !currentGame) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯', 'error');
                return;
            }
            
            if (!currentGame) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¨Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            const piece = chessBoard[row][col];
            
            // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø®Ø§Ù†Ù‡â€ŒØ§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯
            if (selectedSquare) {
                const [prevRow, prevCol] = selectedSquare;
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬Ø§Ø² Ø¨ÙˆØ¯Ù† Ø­Ø±Ú©Øª
                if (isValidMove(prevRow, prevCol, row, col)) {
                    // Ø§Ù†Ø¬Ø§Ù… Ø­Ø±Ú©Øª
                    movePiece(prevRow, prevCol, row, col);
                    selectedSquare = null;
                    clearHighlights();
                    
                    // Ø­Ø±Ú©Øª Ù…ÙˆØªÙˆØ±
                    setTimeout(makeEngineMove, 500);
                } else {
                    // Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ù†Ù‡ Ø¬Ø¯ÛŒØ¯
                    selectedSquare = [row, col];
                    highlightLegalMoves(row, col);
                }
            } else if (piece && (
                (playerColor === 'white' && piece === piece.toUpperCase()) ||
                (playerColor === 'black' && piece === piece.toLowerCase())
            )) {
                // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù‡Ø±Ù‡
                selectedSquare = [row, col];
                highlightLegalMoves(row, col);
            }
        }
        
        // Ø­Ø±Ú©Øª Ù…Ù‡Ø±Ù‡
        function movePiece(fromRow, fromCol, toRow, toCol) {
            const piece = chessBoard[fromRow][fromCol];
            const captured = chessBoard[toRow][toCol];
            
            chessBoard[fromRow][fromCol] = '';
            chessBoard[toRow][toCol] = piece;
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø­Ø±Ú©Øª
            const move = {
                from: {row: fromRow, col: fromCol},
                to: {row: toRow, col: toCol},
                piece: piece,
                captured: captured
            };
            
            movesHistory.push(move);
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ®ØªÙ‡
            updateBoardDisplay();
            updateMoveList();
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§ÛŒØ§Ù† Ø¨Ø§Ø²ÛŒ
            checkGameStatus();
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØ®ØªÙ‡
        function updateBoardDisplay() {
            const squares = document.querySelectorAll('.chess-square');
            
            squares.forEach(square => {
                const row = parseInt(square.dataset.row);
                const col = parseInt(square.dataset.col);
                const piece = chessBoard[row][col];
                
                square.innerHTML = '';
                
                if (piece) {
                    const pieceDiv = document.createElement('div');
                    pieceDiv.className = `piece ${piece === piece.toLowerCase() ? 'black' : 'white'}`;
                    pieceDiv.textContent = pieceSymbols[piece];
                    pieceDiv.style.cursor = 'pointer';
                    square.appendChild(pieceDiv);
                }
            });
        }
        
        // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯
        async function startGame(difficulty, type) {
            if (!currentUser && type === 'premium') {
                showMessage('Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯', 'error');
                return;
            }
            
            if (type === 'premium' && currentUser.coins < 10) {
                showMessage('Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø­Ø¯Ø§Ù‚Ù„ Û±Û° Ø³Ú©Ù‡ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯', 'error');
                return;
            }
            
            currentGame = {
                id: `game_${Date.now()}`,
                difficulty: difficulty,
                type: type,
                startTime: new Date(),
                moves: []
            };
            
            initializeBoard();
            movesHistory = [];
            
            if (type === 'premium') {
                currentUser.coins -= 10;
                updateUserDisplay();
                localStorage.setItem('chess_user', JSON.stringify(currentUser));
            }
            
            document.getElementById('game-status').textContent = 
                `Ø¨Ø§Ø²ÛŒ ${type === 'free' ? 'Ø±Ø§ÛŒÚ¯Ø§Ù†' : 'Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ'} Ø´Ø±ÙˆØ¹ Ø´Ø¯ - Ø³Ø·Ø­: ${difficulty}`;
            document.getElementById('position-eval').textContent = '+0.00';
            
            showMessage(`ğŸ® Ø¨Ø§Ø²ÛŒ ${type === 'free' ? 'Ø±Ø§ÛŒÚ¯Ø§Ù†' : 'Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ'} Ø´Ø±ÙˆØ¹ Ø´Ø¯!`, 'success');
            
            // Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒÚ©Ù† Ø³ÛŒØ§Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ù…ÙˆØªÙˆØ± Ø§ÙˆÙ„ Ø­Ø±Ú©Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
            if (playerColor === 'black') {
                setTimeout(makeEngineMove, 1000);
            }
        }
        
        // Ø­Ø±Ú©Øª Ù…ÙˆØªÙˆØ±
        async function makeEngineMove() {
            if (!currentGame) return;
            
            try {
                const response = await fetch('/api/chess/move', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fen: getBoardFEN(),
                        difficulty: currentGame.difficulty
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const from = data.from;
                    const to = data.to;
                    
                    // Ø§Ù†Ø¬Ø§Ù… Ø­Ø±Ú©Øª Ù…ÙˆØªÙˆØ±
                    movePiece(from.row, from.col, to.row, to.col);
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ
                    document.getElementById('position-eval').textContent = 
                        data.evaluation > 0 ? `+${data.evaluation}` : data.evaluation;
                    
                    currentGame.moves.push(data.move);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø­Ø±Ú©Øª Ù…ÙˆØªÙˆØ±:', error);
                // Ø­Ø±Ú©Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
                setTimeout(() => {
                    const moves = getEngineMoves();
                    if (moves.length > 0) {
                        const randomMove = moves[Math.floor(Math.random() * moves.length)];
                        movePiece(randomMove.from.row, randomMove.from.col, randomMove.to.row, randomMove.to.col);
                    }
                }, 500);
            }
        }
        
        // Ú¯Ø±ÙØªÙ† Ø­Ø±Ú©Ø§Øª Ù…ÙˆØªÙˆØ± (Ø³Ø§Ø¯Ù‡)
        function getEngineMoves() {
            const moves = [];
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const piece = chessBoard[row][col];
                    if (piece && piece === piece.toLowerCase()) { // Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ§Ù‡
                        const legalMoves = getLegalMoves(row, col);
                        moves.push(...legalMoves.map(move => ({
                            from: {row, col},
                            to: move,
                            piece: piece
                        })));
                    }
                }
            }
            
            return moves;
        }
        
        // Ø­Ø±Ú©Ø§Øª Ù…Ø¬Ø§Ø² (Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡)
        function getLegalMoves(row, col) {
            const piece = chessBoard[row][col];
            const moves = [];
            
            if (!piece) return moves;
            
            // Ù¾ÛŒØ§Ø¯Ù‡
            if (piece.toLowerCase() === 'p') {
                const direction = piece === 'P' ? -1 : 1;
                const startRow = piece === 'P' ? 6 : 1;
                
                // Ø­Ø±Ú©Øª Ø¨Ù‡ Ø¬Ù„Ùˆ
                const newRow = row + direction;
                if (newRow >= 0 && newRow < 8 && !chessBoard[newRow][col]) {
                    moves.push({row: newRow, col});
                    
                    // Ø­Ø±Ú©Øª Ø¯Ùˆ Ø®Ø§Ù†Ù‡ Ø¯Ø± Ø´Ø±ÙˆØ¹
                    if (row === startRow && !chessBoard[newRow + direction][col]) {
                        moves.push({row: newRow + direction, col});
                    }
                }
                
                // Ú¯Ø±ÙØªÙ†
                for (let dc of [-1, 1]) {
                    const newCol = col + dc;
                    if (newCol >= 0 && newCol < 8 && newRow >= 0 && newRow < 8) {
                        const target = chessBoard[newRow][newCol];
                        if (target && (
                            (piece === 'P' && target === target.toLowerCase()) ||
                            (piece === 'p' && target === target.toUpperCase())
                        )) {
                            moves.push({row: newRow, col: newCol});
                        }
                    }
                }
            }
            
            return moves;
        }
        
        // Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø­Ø±Ú©Ø§Øª Ù…Ø¬Ø§Ø²
        function highlightLegalMoves(row, col) {
            clearHighlights();
            
            const square = document.querySelector(`.chess-square[data-row="${row}"][data-col="${col}"]`);
            if (square) {
                square.classList.add('selected');
            }
            
            const legalMoves = getLegalMoves(row, col);
            legalMoves.forEach(move => {
                const targetSquare = document.querySelector(
                    `.chess-square[data-row="${move.row}"][data-col="${move.col}"]`
                );
                if (targetSquare) {
                    const targetPiece = chessBoard[move.row][move.col];
                    if (targetPiece) {
                        targetSquare.classList.add('legal-capture');
                    } else {
                        targetSquare.classList.add('legal-move');
                    }
                }
            });
        }
        
        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ø§ÛŒÙ„Ø§ÛŒØªâ€ŒÙ‡Ø§
        function clearHighlights() {
            document.querySelectorAll('.chess-square').forEach(square => {
                square.classList.remove('selected', 'legal-move', 'legal-capture');
            });
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ø­Ø±Ú©Øª
        function isValidMove(fromRow, fromCol, toRow, toCol) {
            const legalMoves = getLegalMoves(fromRow, fromCol);
            return legalMoves.some(move => 
                move.row === toRow && move.col === toCol
            );
        }
        
        // Ú¯Ø±ÙØªÙ† FEN ØªØ®ØªÙ‡
        function getBoardFEN() {
            let fen = '';
            
            for (let row = 0; row < 8; row++) {
                let empty = 0;
                for (let col = 0; col < 8; col++) {
                    const piece = chessBoard[row][col];
                    if (piece) {
                        if (empty > 0) {
                            fen += empty;
                            empty = 0;
                        }
                        fen += piece;
                    } else {
                        empty++;
                    }
                }
                if (empty > 0) {
                    fen += empty;
                }
                if (row < 7) {
                    fen += '/';
                }
            }
            
            fen += ' w KQkq - 0 1';
            return fen;
        }
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª Ø­Ø±Ú©Ø§Øª
        function updateMoveList() {
            const container = document.getElementById('moves-container');
            container.innerHTML = '';
            
            for (let i = 0; i < movesHistory.length; i += 2) {
                const moveItem = document.createElement('div');
                moveItem.className = 'move-item';
                
                const moveNumber = Math.floor(i / 2) + 1;
                const whiteMove = movesHistory[i] ? 
                    squareToNotation(movesHistory[i].from) + squareToNotation(movesHistory[i].to) : '';
                const blackMove = movesHistory[i + 1] ? 
                    squareToNotation(movesHistory[i + 1].from) + squareToNotation(movesHistory[i + 1].to) : '';
                
                moveItem.innerHTML = `
                    <div class="move-number">${moveNumber}.</div>
                    <div class="move-white">${whiteMove}</div>
                    <div class="move-black">${blackMove}</div>
                `;
                
                container.appendChild(moveItem);
            }
            
            // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
            container.scrollTop = container.scrollHeight;
        }
        
        function squareToNotation(square) {
            const colChar = String.fromCharCode(97 + square.col);
            const rowNum = 8 - square.row;
            return `${colChar}${rowNum}`;
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ
        function checkGameStatus() {
            // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ú©ÛŒØ´ Ùˆ Ù…Ø§Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø±Ø¯
            // ÙØ¹Ù„Ø§Ù‹ Ø³Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±ÛŒÙ…
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚
            currentUser = {
                id: `user_${Date.now()}`,
                username: username,
                coins: 100,
                rating: 1200,
                games: 0,
                wins: 0,
                losses: 0
            };
            
            localStorage.setItem('chess_user', JSON.stringify(currentUser));
            showUserSection();
            showMessage(`Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ${username}! Û±Û°Û° Ø³Ú©Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒØ¯.`, 'success');
        }
        
        function register() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            if (username.length < 3) {
                showMessage('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û³ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯', 'error');
                return;
            }
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚
            currentUser = {
                id: `user_${Date.now()}`,
                username: username,
                coins: 100,
                rating: 1200,
                games: 0,
                wins: 0,
                losses: 0
            };
            
            localStorage.setItem('chess_user', JSON.stringify(currentUser));
            showUserSection();
            showMessage(`Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ${username}`, 'success');
        }
        
        function logout() {
            currentUser = null;
            localStorage.removeItem('chess_user');
            
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('user-section').style.display = 'none';
            
            showMessage('Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯', 'info');
        }
        
        function showUserSection() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('user-section').style.display = 'block';
            
            document.getElementById('user-coins').textContent = currentUser.coins;
            document.getElementById('user-rating').textContent = currentUser.rating;
            document.getElementById('user-level').textContent = 
                currentUser.rating >= 2000 ? 'Ø§Ø³ØªØ§Ø¯' :
                currentUser.rating >= 1600 ? 'Ù¾ÛŒØ´Ø±ÙØªÙ‡' :
                currentUser.rating >= 1400 ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ø¨ØªØ¯ÛŒ';
            document.getElementById('user-games').textContent = currentUser.games;
        }
        
        function updateUserDisplay() {
            if (currentUser) {
                document.getElementById('user-coins').textContent = currentUser.coins;
            }
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ø¨Ø§Ø²ÛŒ
        function undoMove() {
            if (movesHistory.length > 0) {
                movesHistory.pop();
                initializeBoard();
                movesHistory.forEach(move => {
                    chessBoard[move.to.row][move.to.col] = move.piece;
                    chessBoard[move.from.row][move.from.col] = '';
                });
                updateBoardDisplay();
                updateMoveList();
                showMessage('Ø¢Ø®Ø±ÛŒÙ† Ø­Ø±Ú©Øª Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯', 'info');
            }
        }
        
        function resignGame() {
            if (currentGame) {
                if (confirm('Ø¢ÛŒØ§ Ø§Ø² ØªØ³Ù„ÛŒÙ… Ø´Ø¯Ù† Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                    showMessage('Ø¨Ø§Ø²ÛŒ Ø¨Ø§ ØªØ³Ù„ÛŒÙ… Ø´Ù…Ø§ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯', 'info');
                    currentGame = null;
                    document.getElementById('game-status').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹';
                }
            } else {
                showMessage('Ù‡ÛŒÚ† Ø¨Ø§Ø²ÛŒ ÙØ¹Ø§Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', 'error');
            }
        }
        
        async function analyzePosition() {
            if (!currentGame) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¨Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            if (currentUser && currentUser.coins < 5) {
                showMessage('Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø­Ø¯Ø§Ù‚Ù„ Ûµ Ø³Ú©Ù‡ Ù†ÛŒØ§Ø² Ø¯Ø§Ø±ÛŒØ¯', 'error');
                return;
            }
            
            if (currentUser && confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ûµ Ø³Ú©Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†ÛŒØ¯ØŸ')) {
                currentUser.coins -= 5;
                updateUserDisplay();
                localStorage.setItem('chess_user', JSON.stringify(currentUser));
                
                try {
                    const response = await fetch('/api/chess/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            fen: getBoardFEN(),
                            depth: 4
                        })
                    });
                    
                    const data = await response.json();
                    
                    let analysis = `ğŸ” ØªØ­Ù„ÛŒÙ„ Ù…ÙˆÙ‚Ø¹ÛŒØª:\n`;
                    analysis += `Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ: ${data.evaluation > 0 ? '+' : ''}${data.evaluation}\n`;
                    analysis += `Ø¨Ù‡ØªØ±ÛŒÙ† Ø­Ø±Ú©Øª: ${data.bestMove}\n\n`;
                    analysis += `Ø­Ø±Ú©Ø§Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:\n`;
                    
                    data.moves.forEach((move, index) => {
                        analysis += `${index + 1}. ${move.move} (${move.eval})\n`;
                    });
                    
                    alert(analysis);
                    
                } catch (error) {
                    showMessage('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ØªØ­Ù„ÛŒÙ„', 'error');
                }
            }
        }
        
        // Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡
        function buyCoins(coins, price) {
            if (!currentUser) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯', 'error');
                return;
            }
            
            if (confirm(`Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø®Ø±ÛŒØ¯ ${coins} Ø³Ú©Ù‡ Ø¨Ù‡ Ù…Ø¨Ù„Øº ${price.toLocaleString('fa-IR')} ØªÙˆÙ…Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) {
                currentUser.coins += coins;
                updateUserDisplay();
                localStorage.setItem('chess_user', JSON.stringify(currentUser));
                
                showMessage(`âœ… ${coins} Ø³Ú©Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯!`, 'success');
            }
        }
        
        function buySubscription() {
            if (!currentUser) {
                showMessage('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯', 'error');
                return;
            }
            
            if (confirm('Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø®Ø±ÛŒØ¯ Ø§Ø´ØªØ±Ø§Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ù‡ Ù…Ø¨Ù„Øº Û³Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                showMessage('âœ… Ø§Ø´ØªØ±Ø§Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙØ¹Ø§Ù„ Ø´Ø¯!', 'success');
            }
        }
        
        // Ø¢Ù…Ø§Ø± Ø³ÛŒØ³ØªÙ…
        async function loadStats() {
            try {
                const response = await fetch('/api/chess/status');
                const data = await response.json();
                
                document.getElementById('stats-users').textContent = '2';
                document.getElementById('stats-games').textContent = '1';
                document.getElementById('stats-revenue').textContent = 
                    (data.revenue.daily / 1000).toFixed(0) + 'K';
                document.getElementById('stats-online').textContent = '1';
                
            } catch (error) {
                console.log('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø±:', error);
            }
        }
        
        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        function showMessage(message, type = 'info') {
            let color = '#0ea5e9';
            let icon = 'â„¹ï¸';
            
            switch (type) {
                case 'success':
                    color = '#10b981';
                    icon = 'âœ…';
                    break;
                case 'error':
                    color = '#ef4444';
                    icon = 'âŒ';
                    break;
                case 'warning':
                    color = '#f59e0b';
                    icon = 'âš ï¸';
                    break;
            }
            
            // Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${color};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 1000;
                display: flex;
                align-items: center;
                gap: 15px;
                animation: slideIn 0.3s ease-out;
                max-width: 400px;
            `;
            
            notification.innerHTML = `
                <div style="font-size: 1.5rem;">${icon}</div>
                <div>${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
        
        // ØªØ§Ø¨Ø¹â€ŒÙ‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ
        function showRevenueStats() {
            alert(`ğŸ’° Ø¢Ù…Ø§Ø± Ø¯Ø±Ø¢Ù…Ø¯ Ø´Ø·Ø±Ø¬Ø¯ Ú©ÙˆØ§Ù†ØªØ§\n\n` +
                  `â€¢ Ø¯Ø±Ø¢Ù…Ø¯ Ø±ÙˆØ²Ø§Ù†Ù‡: Û²,ÛµÛ°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\n` +
                  `â€¢ Ø¯Ø±Ø¢Ù…Ø¯ Ù…Ø§Ù‡Ø§Ù†Ù‡: Û¹,ÛµÛ°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\n` +
                  `â€¢ Ø¯Ø±Ø¢Ù…Ø¯ Ø³Ø§Ù„Ø§Ù†Ù‡: Û±Û±Û´,Û°Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\n` +
                  `â€¢ Ù†Ø±Ø® Ø±Ø´Ø¯: Û³ÛµÙª\n\n` +
                  `ğŸ“Š Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ:\n` +
                  `â€¢ Ù…Ø§Ù‡ Ø§ÙˆÙ„: Û¹Ù«Ûµ Ù…ÛŒÙ„ÛŒÙˆÙ† ØªÙˆÙ…Ø§Ù†\n` +
                  `â€¢ Ø³Ù‡ Ù…Ø§Ù‡Ù‡: Û²Û¸Ù«Ûµ Ù…ÛŒÙ„ÛŒÙˆÙ† ØªÙˆÙ…Ø§Ù†\n` +
                  `â€¢ Ø³Ø§Ù„ Ø§ÙˆÙ„: Û±Û±Û´ Ù…ÛŒÙ„ÛŒÙˆÙ† ØªÙˆÙ…Ø§Ù†`);
        }
        
        function showHelp() {
            alert(`â“ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø´Ø·Ø±Ø¬Ø¯ Ú©ÙˆØ§Ù†ØªØ§\n\n` +
                  `ğŸ® Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ:\n` +
                  `Û±. ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯\n` +
                  `Û². Ø¨Ø§Ø²ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† ÛŒØ§ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯\n` +
                  `Û³. Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯\n\n` +
                  `ğŸ’° Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯:\n` +
                  `â€¢ Ù‡Ø± Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ÛŒÚ¯Ø§Ù†: Û±Û°Û° Ø³Ú©Ù‡ Ù‡Ø¯ÛŒÙ‡\n` +
                  `â€¢ Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡: Û±Û°,Û°Û°Û° ØªØ§ Û¸Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\n` +
                  `â€¢ Ø§Ø´ØªØ±Ø§Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡: Û³Û°Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†\n\n` +
                  `â™Ÿï¸ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ:\n` +
                  `â€¢ ØªØ­Ù„ÛŒÙ„ Ø¹Ù…ÛŒÙ‚ Ù…ÙˆÙ‚Ø¹ÛŒØª (Ûµ Ø³Ú©Ù‡)\n` +
                  `â€¢ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø³Ø·Ø­ Ø§Ø³ØªØ§Ø¯\n` +
                  `â€¢ Ø¢Ù…ÙˆØ²Ø´â€ŒÙ‡Ø§ÛŒ ÙˆÛŒØ¯ÛŒÙˆÛŒÛŒ\n\n` +
                  `ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ: quantum@tetrashop.ir`);
        }
        
        // Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
