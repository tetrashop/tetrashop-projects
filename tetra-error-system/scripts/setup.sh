#!/bin/bash

# ุงุณฺฉุฑูพุช ุฑุงูโุงูุฏุงุฒ ุณุณุชู ูุฏุฑุช ุฎุทุง Tetra

echo "๐ ุดุฑูุน ุฑุงูโุงูุฏุงุฒ ุณุณุชู ูุฏุฑุช ุฎุทุง Tetra..."
echo "=============================================="

# ฑ. ูุตุจ ูุงุจุณุชฺฏโูุง
echo "๐ฆ ูุตุจ ูุงุจุณุชฺฏโูุง Node.js..."
npm install
npm install @sentry/node prom-client

# ฒ. ฺฉูพ ูุงู ูุญุท
echo "โ๏ธ  ุงุฌุงุฏ ูุงู ุชูุธูุงุช ูุญุท..."
if [ ! -f .env ]; then
    cp .env.example .env
    echo "โ๏ธ  ูุทูุงู ูุงู .env ุฑุง ุจุง ููุงุฏุฑ ูุงูุน ูพุฑ ฺฉูุฏ"
else
    echo "โ ูุงู .env ุงุฒ ูุจู ููุฌูุฏ ุงุณุช"
fi

# ณ. ฺฉุงููพุงู TypeScript
echo "๐จ ฺฉุงููพุงู ฺฉุฏูุง TypeScript..."
npm run build

# ด. ุงุฌุงุฏ ุฏุงุฑฺฉุชูุฑโูุง ูุงุฒู
echo "๐ ุงุฌุงุฏ ุณุงุฎุชุงุฑ ูพูุดูโูุง..."
mkdir -p logs metrics reports

# ต. ุฑุงูโุงูุฏุงุฒ ุณุฑูุณ
echo "๐ ุฑุงูโุงูุฏุงุฒ ุณุฑูุณ ูุงูุชูุฑูฺฏ..."
npm start &

# ถ. ุงุฌุฑุง ุชุณุชโูุง
echo "๐งช ุงุฌุฑุง ุชุณุชโูุง ุณุณุชู..."
npm test 2>/dev/null || echo "โ๏ธ  ุชุณุชโูุง ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏ"

# ท. ููุงุด ุงุทูุงุนุงุช
echo ""
echo "โ ุฑุงูโุงูุฏุงุฒ ฺฉุงูู ุดุฏ!"
echo ""
echo "๐ ุฏุณุชุฑุณโูุง:"
echo "   - ุณุฑูุณ ุงุตู: http://localhost:3000"
echo "   - ูุชุฑฺฉโูุง: http://localhost:3000/metrics"
echo "   - ฺฏุฒุงุฑุด ุฎุทุงูุง: http://localhost:3000/api/errors/report"
echo ""
echo "๐ง ูุฑุงุญู ุจุนุฏ:"
echo "   1. ูุงู .env ุฑุง ุจุง ููุงุฏุฑ ูุงูุน ูพุฑ ฺฉูุฏ"
echo "   2. ุณุณุชูโูุง ูุงูุชูุฑูฺฏ (Sentry, Slack, etc.) ุฑุง ฺฉุงููฺฏ ฺฉูุฏ"
echo "   3. ุชุณุช ุณูุงุฑููุง ุฎุทุง ุฑุง ุงุฌุฑุง ฺฉูุฏ"
echo "   4. ุฏุงุดุจูุฑุฏ ูุชุฑฺฉโูุง ุฑุง ุฑุงูโุงูุฏุงุฒ ฺฉูุฏ"
echo ""
echo "๐ ุจุฑุง ุจูุจูุฏ ูุชุฑฺฉโูุง SaaS:"
echo "   - MTTR ูุฏู: ุฒุฑ 30 ุฏููู"
echo "   - ุฏุฑ ุฏุณุชุฑุณโูพุฐุฑ: ุจุงูุง 99.9%"
echo "   - ุฑุถุงุช ูุดุชุฑ: ุงูุชุงุฒ ุจุงูุง 4.5/5"
