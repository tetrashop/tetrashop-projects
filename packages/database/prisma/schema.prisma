generator client {
  provider = "prisma-client-js"
  output   = "./node_modules/.prisma/client" // Ø±ÙØ¹ Ù‡Ø´Ø¯Ø§Ø± Ø®Ø±ÙˆØ¬ÛŒ
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Û±. Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³ÛŒØ³ØªÙ… (Ø¨Ø±Ø§ÛŒ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†)
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  passwordHash  String
  apiKeys       ApiKey[]
  role          Role      @default(USER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("users")
}

// Û². Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ API (Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†)
model ApiKey {
  id          String   @id @default(cuid())
  key         String   @unique
  name        String
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenantId    String   @unique // Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©ØªØ§ÛŒ Ù…Ø´ØªØ±ÛŒ
  rateLimit   Int      @default(100) // Ø­Ø¯Ø§Ú©Ø«Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø±ÙˆØ²
  isActive    Boolean  @default(true)
  lastUsed    DateTime?
  createdAt   DateTime @default(now())

  serviceLogs ServiceLog[]

  @@map("api_keys")
  @@index([key])
  @@index([tenantId])
}

// Û³. Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ÛŒ Ù¾Ù„ØªÙØ±Ù… (Û²Û¶ Ø³Ø±ÙˆÛŒØ³ Ø´Ù…Ø§)
model Service {
  id            String   @id @default(cuid())
  slug          String   @unique // Ù…Ø«Ø§Ù„: "image-enhancement"
  name          String   // ÙØ§Ø±Ø³ÛŒ: "Ø¨Ù‡Ø¨ÙˆØ¯ ØªØµÙˆÛŒØ±"
  nameEn        String?  // Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ: "Image Enhancement"
  description   String?
  category      String   // "Ø¨ÛŒÙ†Ø§ÛŒÛŒ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±", "NLP", "Ù¾Ø±Ø¯Ø§Ø²Ø´ ØµÙˆØª"
  icon          String?  // "ğŸ‘ï¸"
  endpointPath  String?  // Ù…Ø³ÛŒØ± API Ø¯Ø§Ø®Ù„ÛŒ
  pricePerCall  Float    @default(0.0) // Ù‚ÛŒÙ…Øª Ø¨Ù‡ ÙˆØ§Ø­Ø¯ Ø§Ø¹ØªØ¨Ø§Ø±
  isActive      Boolean  @default(true)
  config        Json?    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø®Ø§Øµ Ø³Ø±ÙˆÛŒØ³
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  logs          ServiceLog[]

  @@map("services")
}

// Û´. Ù„Ø§Ú¯ Ø§Ø¬Ø±Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
model ServiceLog {
  id           String   @id @default(cuid())
  apiKeyId     String
  apiKey       ApiKey   @relation(fields: [apiKeyId], references: [id], onDelete: Cascade)
  serviceId    String
  service      Service  @relation(fields: [serviceId], references: [id])
  inputData    Json?    // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
  outputData   Json?    // Ù†ØªÛŒØ¬Ù‡ Ø®Ø±ÙˆØ¬ÛŒ Ø³Ø±ÙˆÛŒØ³
  status       LogStatus @default(SUCCESS)
  errorMessage String?
  durationMs   Int?     // Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§ Ø¨Ù‡ Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡
  cost         Float?   // Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime @default(now())

  @@map("service_logs")
  @@index([apiKeyId, createdAt])
  @@index([serviceId])
  @@index([createdAt])
}

// Ûµ. Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± Ù‡Ø± Ù…Ø´ØªØ±ÛŒ
model CreditBalance {
  id          String   @id @default(cuid())
  tenantId    String   @unique // Ù…Ø±ØªØ¨Ø· Ø¨Ø§ ApiKey.tenantId
  balance     Float    @default(0.0)
  totalSpent  Float    @default(0.0)
  lastTopUpAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  transactions CreditTransaction[]

  @@map("credit_balances")
}

// Û¶. ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§ÙØ²Ø§ÛŒØ´ Ø§Ø¹ØªØ¨Ø§Ø±
model CreditTransaction {
  id          String   @id @default(cuid())
  balanceId   String
  balance     CreditBalance @relation(fields: [balanceId], references: [id], onDelete: Cascade)
  amount      Float    // Ù…Ø¨Ù„Øº Ù…Ø«Ø¨Øª = Ø§ÙØ²Ø§ÛŒØ´ Ø§Ø¹ØªØ¨Ø§Ø±
  reason      String   // "Ø®Ø±ÛŒØ¯ Ø¢Ù†Ù„Ø§ÛŒÙ†", "Ù‡Ø¯ÛŒÙ‡ ØªØ¨Ù„ÛŒØºØ§ØªÛŒ"
  referenceId String?  // Ø´Ù†Ø§Ø³Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø®Ø§Ø±Ø¬ÛŒ
  metadata    Json?
  createdAt   DateTime @default(now())

  @@map("credit_transactions")
  @@index([balanceId, createdAt])
}

// Ø§Ù†ÙˆØ§Ø¹ (Enums)
enum Role {
  ADMIN
  USER
}

enum LogStatus {
  PENDING
  PROCESSING
  SUCCESS
  FAILED
  RATE_LIMITED
}
